!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("regenerator-runtime")):"function"==typeof define&&define.amd?define(["exports","regenerator-runtime"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MindmapView={},e.regeneratorRuntime)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=n(t);const o="function"==typeof crypto.randomUUID?crypto.randomUUID.bind(crypto):function(){return crypto.getRandomValues(new Uint8Array(10)).join("-")};function r(e,t,...n){if(e)return e;throw"function"==typeof t?t.apply(void 0,n):t}const a=Symbol("EBlockContainer.DomEventHandler"),s=Symbol("EBlockContainer.DomEventProc");class c{static DomEventDispatcher=s;constructor(){Object.defineProperty(this,a,{value:this[s].bind(this),writable:!1})}define(e){throw new Error("No implementation")}undefine(e){throw new Error("No implementation")}get stageContainer(){throw new Error("No implementation")}get eventContainer(){throw new Error("No implementation")}enableDomEvent(e){return this.eventContainer.addEventListener(e,this[a]),this}disableDomEvent(e){return this.eventContainer.removeEventListener(e,this[a]),this}addEventListener(...e){return this.eventContainer.addEventListener(...e),this}removeEventListener(...e){return this.eventContainer.addEventListener(...e),this}[s](e){throw new Error("No implementation")}}class l{static RegistryMap=new WeakMap;static AcquireRegistry(e){r(e instanceof c,Error,"The _container must be an instance of EBlockContainer");let t=l.RegistryMap.get(e);return t instanceof WeakSet||(t=new WeakSet,l.RegistryMap.set(e,t)),t}static peekPredefineds(e,t){const n=[...e.querySelectorAll("[eblock-predefined]")];return t||(t=""),n.forEach((e=>e.setAttribute("eblock-predefined",t))),n}static peekScripts(e){let t={};return[...e.querySelectorAll("[eblock-script]")].forEach((e=>{let n=new Function("declarer",`${e.textContent};return declarer;`);try{t=n(t)}catch(t){console.error("Exception raised when generating the script",e,t)}})),t}static peekTemplateNode(e){return e.querySelector("[eblock-template]")}constructor(e){r(e&&"function"==typeof e.querySelectorAll,Error,"The _node must be an instance can invoke querySelector");const t=o();Object.defineProperties(this,{id:{writable:!1,value:t},source:{writable:!1,value:e},predefineds:{writable:!1,value:l.peekPredefineds(e,t)},scripts:{writable:!1,value:l.peekScripts(e)},templateNode:{writable:!1,value:l.peekTemplateNode(e)}})}register(e){const t=l.AcquireRegistry(e);return t.has(this)||(this.predefineds.forEach((t=>e.define(t.cloneNode(!0)))),"function"==typeof this.onFactorRegister&&this.onFactorRegister(e),this.callScript("onFactorRegister",this,e),t.add(this)),this}unregister(e){const t=l.AcquireRegistry(e);return t.has(this)&&("function"==typeof this.onFactorUnregister&&this.onFactorUnregister(e),this.callScript("onFactorUnregister",this,e),e.undefine(`[eblock-predefined="${this.id}"]`),t.delete(this)),this}generate(e,t,n,...i){r("function"==typeof t&&t.prototype instanceof b,Error,"The _blockClass must be inherited from EBlock"),r(e instanceof Node,Error,"The _containerNode must be an instance of Node");let o=new t(this,n,...i);return e&&o.mount(e),o}generateFromTemplate(){return this.templateNode&&this.templateNode.cloneNode(!0)}queryNodeFromTemplate(e){return this.templateNode&&e&&this.templateNode.querySelector(e)}callScript(e,t,...n){return this.applyScript(e,t,n)}applyScript(e,t,n){const i=this.scripts[e];return"function"==typeof i&&i.apply(t,n)}}const u=Symbol("eblock.block.id"),p=Symbol("eblock.constructor.ref"),h=Symbol("eblock.factor.ref"),f=Symbol("eblock.data.ref"),v=new WeakMap;function g(){return this.source[this.key]}function m(e){this.source[this.key]=e}class b{static GetInstance(e){if(e instanceof Node)try{let t=v.get(e);return t&&new t[p](e,void 0)}catch{return null}}static equal(e,t){return e instanceof b?e.equal(t):void 0===e&&void 0===t}constructor(e,t,...n){let i,a,s=!1;e instanceof Node?(a=e,i=v.get(a),r(i,Error,"The node is not assigned with the avaliable metadata"),r(i[p]===this.constructor,Error,"The node is not matched the special class derived from EBlock")):(r(e instanceof l,Error,"_factorOrNode must be an instance of EBlockFactor or Node"),a=e.generateFromTemplate(),r(a instanceof Node,Error,"Cannot clone the node from the template"),i={[u]:o(),[p]:this.constructor,[h]:e,[f]:t,queuePromise:null},e.callScript("onInitMetadata",e,i,t,a,...n),this.initMetadata(i,t,a,...n),v.set(a,i),s=!0);const c=Object.getOwnPropertyDescriptors(i),d={$assignedNode:{value:a,writable:!1,configurable:!1,enumerable:!0},data:{value:i[f],writable:!1,configurable:!1,enumerable:!0},factor:{value:i[h],writable:!1,configurable:!1,enumerable:!0},blockID:{value:i[u],writable:!1,configurable:!1,enumerable:!0},$stubFlag:{value:!s,writable:!1,configurable:!1,enumerable:!0}};for(let e in c)if("symbol"!=typeof e){let t=c[e];if(t.get||t.set)d["$"+e]=t;else{let n={source:i,key:e};d["$"+e]={get:g.bind(n),set:t.writable?m.bind(n):void 0,configurable:!1,enumerable:t.enumerable}}}for(let e of Object.getOwnPropertySymbols(i))if(!(e in d)){let t={source:i,key:e};d[e]={get:g.bind(t),set:m.bind(t),configurable:!1,enumerable:!1}}Object.defineProperties(this,d),s&&this.queueAction((()=>this.fireEvent("ebevent-create",t)))}initMetadata(e,t,n,...i){}acquireNode(e,t,n){if(e){let i=this.$assignedNode.querySelector(e);return!i&&t?(i=this.factor.queryNodeFromTemplate(e),i&&(i=i.cloneNode(!0)),i&&t.insertAdjacentElement(n||"afterend",i)):t&&t.insertAdjacentElement(n||"afterend",i),i}}equal(e){return e instanceof b&&this.$assignedNode===e.$assignedNode}queueAction(e){return"function"==typeof e&&(this.$queuePromise instanceof Promise?this.$queuePromise=this.$queuePromise.then((()=>{try{return e()}catch(e){console.warn(`Exception raised in processing action in queue[#${this.blockID}]`,e)}})):this.$queuePromise=Promise.resolve(void 0).then((()=>{try{return e()}catch(e){console.warn(`Exception raised in processing action in queue[#${this.blockID}]`,e)}}))),this}fireEvent(e,...t){try{const n=this.factor;[...this.$assignedNode.querySelectorAll(`${this.eventSelectorPrefix||""}[${e}]`)].reverse().forEach((i=>{let o=i.getAttribute(e);o&&n.applyScript(o,this,[...t,i])}));let i=this.$assignedNode.getAttribute(e);i&&n.applyScript(i,this,[...t,this.$assignedNode]);let o=this[`on-${e}`];"function"==typeof o&&o.apply(this,t)}catch(t){console.warn(`Exception raised in fireEvent(${e})[#${this.blockID}]`,t)}return this}mount(e){return e instanceof Node?(this.fireEvent("ebevent-mounting",this.data),e.appendChild(this.$assignedNode),this.fireEvent("ebevent-mounted",this.data)):console.warn("The _containerNode must be an instance of Node"),this}unmount(){return this.fireEvent("ebevent-unmounting",this.data),this.$assignedNode.remove(),this.fireEvent("ebevent-unmounted",this.data)}render(...e){let t={};return this.fireEvent("ebevent-prepare-render",this.data,t,...e).fireEvent("ebevent-rendering",this.data,t,...e).fireEvent("ebevent-rendered",this.data,t,...e)}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t){return E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},E(e,t)}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function L(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}function T(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function C(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,T(e,t,"get"))}function M(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,T(e,t,"set"),n),n}
/**
                           * @author season <season-studio@outlook.com>
                           * @license Apache-2.0
                           */function B(e,t,n){for(var i=arguments.length,o=new Array(i>3?i-3:0),r=3;r<i;r++)o[r-3]=arguments[r];if(this instanceof B){var a=Reflect.construct(Error,[t].concat(o));return a.code=e,a.detail=n,Object.setPrototypeOf(a,Object.getPrototypeOf(this)),Error.captureStackTrace&&Error.captureStackTrace(a,B),a}return Reflect.construct.apply(Reflect,[B].concat(Array.prototype.slice.call(arguments)))}function D(e,t,n,i,o,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}function z(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){D(r,i,o,a,s,"next",e)}function s(e){D(r,i,o,a,s,"throw",e)}a(void 0)}))}}function R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function I(e,t,n){return I=R()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&E(o,n.prototype),o},I.apply(null,arguments)}function q(e){var t="function"==typeof Map?new Map:void 0;return q=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return I(e,arguments,N(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),E(i,e)},q(e)}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}B.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(B,Error):B.__proto__=Error;var O=i.default;function P(e,t){if(e)return e;throw"function"==typeof t?t.apply(void 0,[...arguments].slice(2)):t}function j(e,t){if(e&&t){Object.assign(e,t);for(let n in e){let i=e[n];i&&"object"==typeof i&&(e[n]=j(i instanceof Array?[]:{},t[n]))}}return e}function V(e,t,n,i){if(e&&t)if("object"==typeof t){const i=!(arguments.length>2)||n;for(let n in t)Object.defineProperty(e,n,{value:t[n],writable:!1,enumerable:i})}else Object.defineProperty(e,t,{value:n,writable:!1,enumerable:!(arguments.length>3)||i});return e}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return L(this,n)}}var H=function(e){A(n,e);var t=G(n);function n(e,i,o){return y(this,n),t.apply(this,arguments)}return k(n,[{key:"initMetadata",value:function(e,t,n,i){}},{key:"name",get:function(){return this.factor.$info.name}},{key:"topic",get:function(){var e=this.$assignedNode.parentNode;return e&&(e=e.parentNode),e&&(e=e.parentNode),e&&b.GetInstance(e)}},{key:"callScript",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.factor.applyScript(e,this,n)}},{key:"applyScript",value:function(e,t,n){return this.factor.applyScript(e,this,n)}}]),n}(b),F=function(e){A(n,e);var t=G(n);function n(e){var i;y(this,n);var o=(i=t.apply(this,arguments)).callScript("getExtensionInfo",x(i));return P(o&&o.name,B,-1,"The extension do not provide it's information and name by function 'getEntensionInfo'"),V(x(i),"$info",o),i}return k(n)}(l);function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return L(this,n)}}function W(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}var U,X=new WeakMap,Y=new WeakMap,K=function(e){A(r,e);var t,n,i=_(r);function r(){var e;return y(this,r),W(x(e=i.call(this)),X,{writable:!0,value:[]}),W(x(e),Y,{writable:!0,value:void 0}),$(x(e),"dragable",!0),$(x(e),"editable",!0),$(x(e),"dragContext",void 0),M(x(e),Y,Object.freeze(j({},r.DefaultConfig))),e}return k(r,[{key:"config",get:function(){return C(this,Y)}},{key:"extensionFactors",get:function(){return C(this,X)}},{key:"randomID",get:function(){return o()}},{key:"syncConfig",value:function(){var e={result:j({},r.DefaultConfig)};this.fireEvent("topic-event-report-configuration",e),M(this,Y,Object.freeze(e.result||j({},r.DefaultConfig))),this.fireEvent("topic-event-sync-configuration",C(this,Y))}},{key:"fireEvent",value:function(e,t){this.dispatchEvent(e instanceof Event?e:new CustomEvent(e,{detail:t}))}},{key:"translateHRefToURL",value:function(e){var t={source:e,destination:e};return this.fireEvent("topic-event-translate-href-url",t),t}},{key:"getHRefType",value:function(e){var t={href:e,type:"link"};return this.fireEvent("topic-event-get-href-type",t),t.type}},{key:"getImageDataFromElement",value:function(e,t){try{t||(t={});var n=document.createElement("canvas"),i=Number(t.width)||Number(e.width),o=Number(t.height)||Number(e.height);P(i&&o,B,-1,"The width and height is invalid!"),n.width=i,n.height=o;var r=n.getContext("2d");return r.fillStyle=t.fill||"rgba(255,255,255,0)",r.fillRect(0,0,i,o),r.drawImage(e,Number(t.offsetX)||0,Number(t.offsetY)||0),t.toBlob?new Promise((function(e){return n.toBlob((function(t){e({width:i,height:o,data:t})}),"image/".concat(t.type||"png"))})):Promise.resolve({width:i,height:o,data:n.toDataURL("image/".concat(t.type||"png"))})}catch(e){this.warn("Fail in get image's data from an element",e)}}},{key:"getImageData",value:(n=z(O.mark((function e(t,n){var i;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n||(n={}),(i=new Image).src=t,n.crossOrigin&&(i.crossOrigin=n.crossOrigin),e.next=7,i.decode();case 7:return e.next=9,this.getImageDataFromElement(i,n);case 9:return e.abrupt("return",e.sent);case 12:e.prev=12,e.t0=e.catch(0),this.warn("Fail in load image:",t,e.t0);case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"warn",value:function(){var e;(e=console).warn.apply(e,arguments)}},{key:"confirm",value:(t=z(O.mark((function e(t,n){return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n||{}).default||0);case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"activeLink",value:function(e){e&&window.open(e,"_blank")}}]),r}(q(EventTarget));function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return L(this,n)}}function Z(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}$(K,"DefaultConfig",Object.freeze({padding:10,secondaryPadding:5,levelMargin:46,secondaryLevelMargin:26,siblingMargin:26,secondarySiblingMargin:17,secondaryTopicLevel:2,suitableTitleLineWidth:120,directionPriority:"right",dragStartFocusFilterTimer:50,dragStartNoFocusFilterTimer:100,resourceScheme:"xap",defaultResourceAttachmentPrefix:"resources/",placeholderImageId:"season-topic-predefine-image-picture-placeholder"}));var J=Symbol("MindmapContainer.ResizeProc"),ee=Symbol("MindmapContainer.ResizeObserverHandler"),te=new WeakMap;U=c.DomEventDispatcher;var ne=function(e){A(n,e);var t=Q(n);function n(e,i){var r;y(this,n),P(e instanceof Node,B,-1,"_parentNode must be an instance of Node"),P(i instanceof K,B,-1,"_env must be an instance of MindmapEnvironment"),Z(x(r=t.call(this)),te,{writable:!0,value:void 0}),e.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" tabindex="0" overflow="hidden" width="640" height="480" viewBox="0 0 640 480" style="outline:none;">\n<style>\n    [season-mind-map-svg] {\n        --topic-ui-focus-color: #5cf;\n        --topic-ui-focus-border-color: #055cff;\n        --topic-ui-danger-color: #f22;\n        --topic-ui-emphasize-front-color: #fff;\n        --topic-ui-hover-back-color: #ccc;\n        \n        -webkit-touch-callout: none; /* iOS Safari */\n        -webkit-user-select: none; /* Chrome/Safari/Opera */\n        -khtml-user-select: none; /* Konqueror */\n        -moz-user-select: none; /* Firefox */\n        -ms-user-select: none; /* Internet Explorer/Edge */\n        user-select: none; /* Non-prefixed version, currently not supported by any browser */\n    }\n    \n    [season-mind-map-svg] *::-webkit-scrollbar {\n        width: 10px;\n        height: 10px;\n        background: transparent;\n        cursor: point;\n    }\n    [season-mind-map-svg] *::-webkit-scrollbar-corner {\n        background: transparent;\n    }\n    [season-mind-map-svg] *::-webkit-scrollbar-track {\n        background: transparent;\n        cursor: point;\n    }\n    [season-mind-map-svg] *::-webkit-scrollbar-thumb\n    {\n        -webkit-border-radius: 7px;\n        border-radius: 7px;\n        background: rgba(57,57,57,0.1);\n        cursor: point;\n    }\n    [season-mind-map-svg] *:hover::-webkit-scrollbar-thumb {\n        -webkit-border-radius: 7px;\n        border-radius: 7px;\n        background: rgba(0,0,0,0.1); \n        cursor: point;\n    }\n\n    .season-topic-svg-button > rect {\n        fill: rgba(255,255,255,0.05);\n        stroke: none;\n    }\n    .season-topic-svg-button[d-svg-button-has-border] > rect {\n        fill: rgba(255,255,255,0.05);\n        stroke: var(--topic-ui-hover-back-color);\n    }\n    .season-topic-svg-button > use, .season-topic-svg-button > path {\n        fill: #000;\n        stroke: none;\n    }\n    .season-topic-svg-button:hover > rect {\n        fill: var(--topic-ui-hover-back-color);\n    }\n    .season-topic-svg-button:hover > use, .season-topic-svg-button:hover > path {\n        fill: #000;\n    }\n    .season-topic-svg-button[d-svg-button-danger]:hover > rect {\n        fill: var(--topic-ui-danger-color);\n    }\n    .season-topic-svg-button[d-svg-button-danger]:hover > use, .season-topic-svg-button[d-svg-button-danger]:hover > path {\n        fill: var(--topic-ui-emphasize-front-color);\n    }\n\n    .season-topic-svg-3d-button > rect {\n        fill: url(#season-svg-3d-fill);\n        stroke-width: 0.5px;\n        stroke: #bbb;\n    }\n    .season-topic-svg-3d-button > use, .season-topic-svg-button > path {\n        fill: #000;\n        stroke: none;\n    }\n    .season-topic-svg-3d-button:hover > rect {\n        fill: url(#season-svg-3d-fill-hover);\n        stroke-width: 0.5px;\n        stroke: #bbb;\n    }\n    .season-topic-svg-3d-button:hover > use, .season-topic-svg-button:hover > path {\n        fill: #fff;\n        stroke: none;\n    }\n    .season-topic-svg-3d-button:active > rect {\n        fill: url(#season-svg-3d-fill-active);\n        stroke-width: 0.5px;\n        stroke: #bbb;\n    }\n    .season-topic-svg-3d-button:active > use, .season-topic-svg-button:active > path {\n        fill: #fff;\n        stroke: none;\n    }\n    .season-topic-svg-3d-button[d-svg-button-danger]:hover > rect {\n        fill: url(#season-svg-3d-danger-fill-hover);\n        stroke-width: 0.5px;\n        stroke: #bbb;\n    }\n    .season-topic-svg-3d-button[d-svg-button-danger]:hover > use, .season-topic-svg-button[d-svg-button-danger]:hover > path {\n        fill: #fff;\n        stroke: none;\n    }\n    .season-topic-svg-3d-button[d-svg-button-danger]:active > rect {\n        fill: url(#season-svg-3d-danger-fill-active);\n        stroke-width: 0.5px;\n        stroke: #bbb;\n    }\n    .season-topic-svg-3d-button[d-svg-button-danger]:active > use, .season-topic-svg-button[d-svg-button-danger]:active > path {\n        fill: #fff;\n        stroke: none;\n    }\n    \n</style>\n<defs season-topic-predefine-filter-and-pattern="">\n    <linearGradient id="season-svg-3d-fill" x1="0" y1="0" x2="0" y2="1">\n        <stop stop-color="#fff" stop-opacity="1" offset="0" />\n        <stop stop-color="#f0f0f0" stop-opacity="1" offset="0.3" />\n        <stop stop-color="#e0e0e0" stop-opacity="1" offset="0.9" />\n        <stop stop-color="#ccc" stop-opacity="1" offset="1" />\n    </linearGradient>\n    <linearGradient id="season-svg-3d-fill-hover" x1="0" y1="0" x2="0" y2="1">\n        <stop stop-color="#0af" stop-opacity="1" offset="0" />\n        <stop stop-color="#009dff" stop-opacity="1" offset="0.1" />\n        <stop stop-color="#07f" stop-opacity="1" offset="0.75" />\n        <stop stop-color="#06f" stop-opacity="1" offset="1" />\n    </linearGradient>\n    <linearGradient id="season-svg-3d-fill-active" x1="0" y1="0" x2="0" y2="1">\n        <stop stop-color="#06f" stop-opacity="1" offset="0" />\n        <stop stop-color="#07f" stop-opacity="1" offset="0.1" />\n        <stop stop-color="#009dff" stop-opacity="1" offset="0.75" />\n        <stop stop-color="#0af" stop-opacity="1" offset="1" />\n    </linearGradient>\n    <linearGradient id="season-svg-3d-danger-fill-hover" x1="0" y1="0" x2="0" y2="1">\n        <stop stop-color="#f55" stop-opacity="1" offset="0" />\n        <stop stop-color="#f33" stop-opacity="1" offset="0.1" />\n        <stop stop-color="#f00" stop-opacity="1" offset="0.75" />\n        <stop stop-color="#b00" stop-opacity="1" offset="1" />\n    </linearGradient>\n    <linearGradient id="season-svg-3d-danger-fill-active" x1="0" y1="0" x2="0" y2="1">\n        <stop stop-color="#c00" stop-opacity="1" offset="0" />\n        <stop stop-color="#f00" stop-opacity="1" offset="0.1" />\n        <stop stop-color="#f33" stop-opacity="1" offset="0.75" />\n        <stop stop-color="#f55" stop-opacity="1" offset="1" />\n    </linearGradient>\n</defs>\n<defs season-topic-predefine-image="">\n    <symbol id="season-topic-predefine-image-picture-placeholder" width="76" height="58" viewBox="0 0 76 58" preserveAspectRatio="none">\n        <path d="M 0 0 L 0 58 L 76 58 L 76 0 L 0 0 z M 17 9 C 18.7 9 20 10.3 20 12 C 20 13.7 18.7 15 17 15 C 15.3 15 14 13.7 14 12 C 14 10.3 15.3 9 17 9 z M 17 11 C 16.4 11 16 11.4 16 12 C 16 12.6 16.4 13 17 13 C 17.6 13 18 12.6 18 12 C 18 11.4 17.6 11 17 11 z M 30 11 C 30.3 11 30.7 11.2 30.8 11.4 L 45.8 34.2 L 52.1 22.5 C 52.3 22.2 52.6 22 53 22 C 53.4 22 53.7 22.2 53.9 22.5 L 67.9 46.5 C 68 46.7 68 46.8 68 47 C 68 47.6 67.6 48 67 48 L 8 48 C 7.8 48 7.6 47.9 7.4 47.9 C 6.9 47.6 6.8 47 7.1 46.5 L 17 30.7 C 17.1 30.6 17.2 30.4 17.3 30.3 L 29.2 11.5 C 29.3 11.2 29.7 11 30 11 z M 30 13.9 L 20.7 28.7 L 26.6 26.1 C 27 25.9 27.4 26 27.7 26.3 L 30 28.6 L 32.8 25.8 C 33.1 25.4 33.6 25.4 34 25.6 L 40.1 29.2 L 30 13.9 z M 53 25.1 L 47 36.1 L 53.5 46 L 65.3 46 L 53 25.1 z M 33.7 27.7 L 30.7 30.7 C 30.3 31.1 29.7 31.1 29.3 30.7 L 26.8 28.2 L 18.8 31.8 L 9.801 46 L 51.1 46 L 42.5 32.8 L 33.7 27.7 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-bold" width="20" height="20" viewBox="0 0 20 20" preserveAspectRatio="none">\n        <path d="m 12.04,9.665 q 1.57,0.365 2.2,0.885 0.91,0.74 0.91,1.92 0,1.24 -1,2.05 -1.23,0.98 -3.57,0.98 H 5 v -0.3 q 0.762,0 1.03,-0.14 0.275,-0.14 0.381,-0.37 0.113,-0.23 0.113,-1.13 V 6.429 Q 6.524,5.537 6.411,5.311 6.305,5.075 6.03,4.938 5.755,4.8 5,4.8 V 4.5 h 5.27 q 1.9,0 2.68,0.34 0.78,0.333 1.24,1.005 0.45,0.665 0.45,1.42 0,0.795 -0.57,1.42 -0.57,0.616 -2.03,0.98 z M 9.087,9.446 q 1.153,0 1.693,-0.258 0.56,-0.261 0.85,-0.731 0.29,-0.471 0.29,-1.2 0,-0.73 -0.29,-1.192 Q 11.35,5.595 10.81,5.351 10.27,5.108 9.087,5.116 Z m 0,0.634 v 3.53 0.4 q 0,0.44 0.218,0.67 0.229,0.23 0.665,0.23 0.65,0 1.19,-0.29 0.56,-0.3 0.85,-0.84 0.29,-0.56 0.29,-1.22 0,-0.77 -0.36,-1.38 -0.37,-0.62 -0.99,-0.86 -0.62,-0.25 -1.862,-0.24 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-italic" width="20" height="20" viewBox="0 0 20 20" preserveAspectRatio="none">\n        <path d="m 11.27,15.2 -0.1,0.3 H 6.65 l 0.113,-0.3 q 0.682,0 0.901,-0.11 0.357,-0.14 0.528,-0.39 0.266,-0.38 0.551,-1.35 L 10.66,6.706 Q 10.9,5.878 10.9,5.457 10.9,5.246 10.8,5.1 10.69,4.954 10.48,4.882 10.26,4.797 9.635,4.797 L 9.733,4.5 h 4.257 l -0.1,0.3 q -0.52,0 -0.77,0.114 -0.36,0.161 -0.56,0.462 -0.18,0.3 -0.49,1.33 l -1.9,6.644 q -0.259,0.91 -0.259,1.16 0,0.21 0.1,0.36 0.11,0.13 0.32,0.21 0.23,0.1 0.94,0.12 z" />        \n    </symbol>\n    <symbol id="season-topic-predefine-image-underline" width="20" height="20" viewBox="0 0 20 20" preserveAspectRatio="none">\n        <path d="m 5.4,4.5 v 0.244 c 0.379,0 0.639,0.03 0.779,0.106 0.141,0.07 0.241,0.176 0.298,0.305 0.06,0.122 0.09,0.441 0.09,0.957 V 10.5 c 0,0.74 0.119,1.33 0.356,1.77 0.239,0.44 0.646,0.81 1.223,1.09 0.423,0.21 1.022,0.31 1.798,0.31 0.926,0 1.666,-0.2 2.196,-0.59 0.53,-0.39 0.87,-0.82 1.01,-1.29 0.14,-0.46 0.21,-1.22 0.21,-2.274 V 6.112 c 0,-0.365 0,-0.618 0.1,-0.759 0.1,-0.203 0.2,-0.355 0.37,-0.456 0.16,-0.102 0.37,-0.153 0.62,-0.153 h 0.19 V 4.5 h -3.12 v 0.244 c 0.37,0 0.65,0.05 0.84,0.153 0.13,0.07 0.24,0.184 0.32,0.357 0.1,0.171 0.13,0.457 0.13,0.858 v 3.655 c 0,0.953 -0.1,1.613 -0.26,2.003 -0.16,0.38 -0.42,0.68 -0.76,0.9 -0.34,0.21 -0.76,0.32 -1.24,0.32 -0.42,0 -0.776,-0.1 -1.053,-0.25 C 9.219,12.56 9.019,12.35 8.895,12.09 8.777,11.82 8.717,11.3 8.717,10.5 V 6.112 c 0,-0.511 0.03,-0.83 0.08,-0.957 C 8.854,5.026 8.946,4.927 9.074,4.857 9.206,4.782 9.447,4.744 9.794,4.744 H 10.03 V 4.5 Z m 0,9.73 v 1.27 h 9.23 v -1.27 z" />    \n    </symbol>\n    <symbol id="season-topic-predefine-image-unorder-list" width="20" height="20" viewBox="0 0 20 20" preserveAspectRatio="none">\n        <path d="M 5 5 L 5 6.5 L 6.5 6.5 L 6.5 5 L 5 5 z M 7.5 5 L 7.5 6.5 L 15 6.5 L 15 5 L 7.5 5 z M 5 9.5 L 5 11 L 6.5 11 L 6.5 9.5 L 5 9.5 z M 7.5 9.5 L 7.5 11 L 15 11 L 15 9.5 L 7.5 9.5 z M 5 14 L 5 15.5 L 6.5 15.5 L 6.5 14 L 5 14 z M 7.5 14 L 7.5 15.5 L 15 15.5 L 15 14 L 7.5 14 z " />    \n    </symbol>\n    <symbol id="season-topic-predefine-image-order-list" width="20" height="20" viewBox="0 0 20 20" preserveAspectRatio="none">\n        <path d="M 6.125 5 L 4.5 5.742 L 4.559 5.859 C 4.717 5.79 4.852 5.756 4.963 5.756 C 5.032 5.756 5.093 5.774 5.145 5.811 C 5.199 5.845 5.237 5.889 5.256 5.941 C 5.276 5.991 5.285 6.116 5.285 6.32 L 5.285 8.609 C 5.285 8.887 5.27 9.065 5.242 9.141 C 5.214 9.217 5.16 9.273 5.08 9.312 C 4.999 9.359 4.864 9.383 4.676 9.383 L 4.559 9.383 L 4.559 9.504 L 6.887 9.504 L 6.887 9.383 L 6.785 9.383 C 6.618 9.383 6.498 9.359 6.422 9.312 C 6.349 9.265 6.298 9.204 6.271 9.131 C 6.245 9.055 6.232 8.881 6.232 8.609 L 6.232 5 L 6.125 5 z M 7.5 5 L 7.5 6.5 L 15 6.5 L 15 5 L 7.5 5 z M 8.314 9.5 L 8.314 11 L 15 11 L 15 9.5 L 8.314 9.5 z M 5.939 11 C 5.627 11 5.35 11.1 5.111 11.3 C 4.873 11.5 4.695 11.81 4.578 12.24 L 4.697 12.24 C 4.882 11.91 5.143 11.74 5.477 11.74 C 5.681 11.74 5.853 11.82 5.994 11.97 C 6.135 12.12 6.205 12.3 6.205 12.53 C 6.205 12.84 6.119 13.16 5.947 13.49 C 5.778 13.82 5.296 14.46 4.5 15.41 L 4.5 15.51 L 7.098 15.51 L 7.346 14.26 L 7.229 14.26 C 7.156 14.39 7.095 14.49 7.049 14.56 C 7.003 14.63 6.944 14.66 6.873 14.66 L 6.418 14.66 L 5.463 14.66 C 6.201 13.94 6.679 13.38 6.898 12.98 C 7.059 12.68 7.141 12.39 7.141 12.1 C 7.141 11.94 7.087 11.77 6.982 11.59 C 6.878 11.41 6.735 11.27 6.551 11.16 C 6.366 11.05 6.163 11 5.939 11 z M 8.314 14 L 8.314 15.5 L 15 15.5 L 15 14 L 8.314 14 z " />\n    </symbol>\n    <symbol id="season-topic-predefine-image-open" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="m 11.94,75.97 c 0,0 0.1,0 0.11,0 H 74 L 87.6,46.8 C 88.57,44.77 87.71,42.34 85.69,41.37 85.28,41.18 84.85,41.05 84.4,41 H 80 v -9 c 0,-2.2 -1.79,-3.99 -4,-4 H 46.28 c -0.18,0 -0.36,0 -0.51,-0.15 L 35,20.7 C 34.34,20.27 33.58,20.03 32.8,20 H 14 c -2.21,0 -3.99,1.79 -4,4 v 49.98 c 0,1.08 0.86,1.96 1.94,1.99 z M 84.29,43 c 1.13,0.2 1.88,1.28 1.68,2.4 0,0.18 -0.1,0.35 -0.16,0.51 v 0 0 L 72.75,73.94 v 0 H 14.1 c 0,0 0,0 0,0 0,0 0,0 0,0 L 26.43,44.01 C 26.72,43.4 27.33,43.01 28,43 Z M 12,24 c 0,-1.11 0.9,-2 2,-2 h 18.8 c 0.41,0 0.81,0.17 1.15,0.4 l 10.71,7.11 C 45.14,29.83 45.7,30 46.28,30 H 76 c 1.1,0 2,0.89 2,2 v 8.99 H 29 c -0.1,0 -0.1,0 -0.16,0 H 28 c -1.47,0 -2.79,0.87 -3.4,2.2 L 12.02,73.76 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-nodepad" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <rect width="60" height="80" x="18" y="8" />\n        <path d="M 28,35 h 20 0 M 28,25 h 17 v 0 M 28,45 h 40 v 0 M 28,55 h 40 v 0 M 28,65 h 40 v 0 M 28,75 h 40 v 0" />\n        <circle cx="60" cy="25" r="8" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-picture" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="M 10 19 L 10 77 L 86 77 L 86 19 L 10 19 z M 12 21 L 84 21 L 84 75 L 12 75 L 12 21 z M 27 28 C 25.3 28 24 29.3 24 31 C 24 32.7 25.3 34 27 34 C 28.7 34 30 32.7 30 31 C 30 29.3 28.7 28 27 28 z M 27 30 C 27.6 30 28 30.4 28 31 C 28 31.6 27.6 32 27 32 C 26.4 32 26 31.6 26 31 C 26 30.4 26.4 30 27 30 z M 40 30 C 39.7 30 39.3 30.2 39.2 30.5 L 27.3 49.3 C 27.2 49.4 27.1 49.6 27 49.7 L 17.1 65.5 C 16.8 66 16.9 66.6 17.4 66.9 C 17.6 66.9 17.8 67 18 67 L 77 67 C 77.6 67 78 66.6 78 66 C 78 65.8 78 65.7 77.9 65.5 L 63.9 41.5 C 63.7 41.2 63.4 41 63 41 C 62.6 41 62.3 41.2 62.1 41.5 L 55.8 53.2 L 40.8 30.4 C 40.7 30.2 40.3 30 40 30 z M 40 32.9 L 50.1 48.2 L 44 44.6 C 43.6 44.4 43.1 44.4 42.8 44.8 L 40 47.6 L 37.7 45.3 C 37.4 45 37 44.9 36.6 45.1 L 30.7 47.7 L 40 32.9 z M 63 44.1 L 75.3 65 L 63.5 65 L 57 55.1 L 63 44.1 z M 43.7 46.7 L 52.5 51.8 L 61.1 65 L 19.8 65 L 28.8 50.8 L 36.8 47.2 L 39.3 49.7 C 39.7 50.1 40.3 50.1 40.7 49.7 L 43.7 46.7 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-pencil" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="m 86.82,16.2 -7.03,-7 c -1.56,-1.6 -4.1,-1.6 -5.66,0 0,0 0,0 0,0 L 14.03,69.3 8,88.1 26.75,82 v 0 L 86.82,21.9 c 1.56,-1.6 1.56,-4.1 0,-5.7 z m -19.76,2.9 9.88,9.9 -2.14,2.1 -9.88,-9.9 z m -41.44,61.2 -11.13,3.6 -2.3,-2.3 3.57,-11.2 c 2.03,-1.6 5.58,-0.9 8.17,1.7 2.58,2.6 3.28,6.1 1.69,8.2 z m -0.28,-9.6 c -1.79,-1.9 -4.22,-3 -6.8,-3.1 l 44.97,-45 9.88,9.9 -44.95,45 c -0.13,-2.6 -1.24,-5 -3.1,-6.8 z m 60.06,-50.2 -7.05,7 -9.88,-9.8 7.07,-7.1 c 0.78,-0.8 2.05,-0.8 2.83,0 0,0 0,0 0,0 l 7.03,7.1 c 0.78,0.7 0.78,2 0,2.8 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-delete" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="M 42 10 C 39.24 10 37 12.2 37 15 L 37 18 L 19 18 C 16.79 18 15.01 19.8 15 22 L 15 28 L 81 28 L 81 22 C 81 19.8 79.21 18 77 18 L 59 18 L 59 15 C 59 12.2 56.76 10 54 10 L 42 10 z M 42 12 L 54 12 C 55.66 12 57 13.3 57 15 L 57 18 L 39 18 L 39 15 C 39 13.3 40.34 12 42 12 z M 19 20 L 77 20 C 78.11 20 79 20.9 79 22 L 79 26 L 17 26 L 17 22 C 17 20.9 17.89 20 19 20 z M 20.5 31 C 19.67 31 19 31.67 19 32.5 C 19 32.59 19.01 32.68 19.03 32.77 C 19.01 32.86 19 32.95 19 33.04 L 19 80.04 C 19 80.12 19.01 80.19 19.02 80.27 C 19.01 80.35 19 80.42 19 80.5 C 19 81.33 19.67 82 20.5 82 L 75.5 82 C 76.33 82 77 81.33 77 80.5 C 77 80.42 76.99 80.35 76.98 80.27 C 76.99 80.19 77 80.12 77 80.04 L 77 33.04 C 77 32.95 76.99 32.86 76.97 32.77 C 76.99 32.68 77 32.59 77 32.5 C 77 31.67 76.33 31 75.5 31 L 20.5 31 z M 22 34 L 74 34 L 74 79 L 22 79 L 22 34 z M 34 38 C 33.17 38 32.5 38.59 32.5 39.32 L 32.5 73.68 C 32.5 74.41 33.17 75 34 75 C 34.83 75 35.5 74.41 35.5 73.68 L 35.5 39.32 C 35.5 38.59 34.83 38 34 38 z M 48 38 C 47.17 38 46.5 38.59 46.5 39.32 L 46.5 73.68 C 46.5 74.41 47.17 75 48 75 C 48.83 75 49.5 74.41 49.5 73.68 L 49.5 39.32 C 49.5 38.59 48.83 38 48 38 z M 62 38 C 61.17 38 60.5 38.59 60.5 39.32 L 60.5 73.68 C 60.5 74.41 61.17 75 62 75 C 62.83 75 63.5 74.41 63.5 73.68 L 63.5 39.32 C 63.5 38.59 62.83 38 62 38 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-eraser" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="M 84.09,39.93 58.63,14.43 c -1.95,-1.9 -5.12,-1.9 -7.07,0 l -39.6,39.6 c -1.95,2 -1.95,5.1 0,7.1 l 22.22,22.19 h 43.85 v -2 h -28.3 l 34.36,-34.4 c 1.95,-1.9 1.95,-5.1 0,-6.99 z M 35.03,81.32 H 35 L 13.38,59.72 c -1.17,-1.19 -1.17,-3.09 0,-4.3 0,0 0,0 0,0 l 19.09,-19.1 29.7,29.7 -15.27,15.3 z M 82.67,45.53 63.58,64.62 33.88,34.93 52.98,15.82 c 1.17,-1.1 3.07,-1.1 4.24,0 l 25.45,25.5 c 1.17,1.2 1.17,3.1 0,4.21 z" />\n    </symbol>\n    <symbol id="season-topic-predefine-image-cross" width="96" height="96" viewBox="0 0 96 96" preserveAspectRatio="none">\n        <path d="M 83,21.4 74.6,13 48,39.6 21.4,13 13,21.4 39.6,48 13,74.6 21.4,83 48,56.4 74.6,83 83,74.6 56.4,48 Z" />\n    </symbol>\n</defs>\n<defs season-topic-image-storage="">\n</defs>\n<g season-topic-root-node=""></g>\n</svg>\n';var a=e.querySelector("svg");a.setAttribute("season-mind-map-svg",o()),a.$scale=1,e.style.overflow="hidden";var s=getComputedStyle(e).position;return"relative"!==s&&"absolute"!==s&&(e.style.position="relative"),V(x(r),{env:i,svgElement:a,stageContainer:a.querySelector("g[season-topic-root-node]"),eventContainer:a}),M(x(r),te,new ResizeObserver(r[ee].bind(x(r)))).observe(e),r[J]({width:e.clientWidth,height:e.clientHeight}),r}return k(n,[{key:"define",value:function(e){this.svgElement.insertBefore(e,this.stageContainer)}},{key:"undefine",value:function(e){this.svgElement.querySelectorAll(e).forEach((function(e){return e.remove()}))}},{key:J,value:function(e){var t=this.svgElement,n=Number(t.$scale);n>0||(n=1);var i=t.viewBox.baseVal;t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("viewBox","".concat(i.x," ").concat(i.y," ").concat(e.width/n," ").concat(e.height/n))}},{key:"scale",get:function(){return Number(this.svgElement.$scale)||1}},{key:"scale",set:function(e){(e=Number(e))>0||(e=1);var t=this.svgElement;t.$scale=e;var n=t.viewBox.baseVal,i=Number(t.width.baseVal.value),o=Number(t.height.baseVal.value);t.setAttribute("viewBox","".concat(n.x," ").concat(n.y," ").concat(i/e," ").concat(o/e)),this.env.fireEvent("topic-event-view-resize")}},{key:"move",value:function(e,t){var n=this.svgElement,i=n.viewBox.baseVal,o=i.x+(Number(e)||0),r=i.y+(Number(t)||0),a=r+i.height,s=o+i.width,c=this.stageContainer.getBBox(),l=c.x,u=c.y,p=c.width;u+c.height<r||u>a||l>s||l+p<o||n.setAttribute("viewBox","".concat(o," ").concat(r," ").concat(i.width," ").concat(i.height))}},{key:ee,value:function(e){var t=this,n=this.svgElement.parentNode;e.forEach((function(e){e.target===n&&t[J](e.contentRect)})),this.env.fireEvent("topic-event-view-resize")}},{key:"createDomEvent",value:function(e,t){return new CustomEvent("topic-domevent-".concat(e),{detail:t})}},{key:"addEventListener",value:function(){var e;return(e=this.env).addEventListener.apply(e,arguments),this}},{key:"removeEventListener",value:function(){var e;return(e=this.env).addEventListener.apply(e,arguments),this}},{key:"dispose",value:function(){C(this,te)&&C(this,te).disconnect(),this.svgElement.remove()}},{key:U,value:function(e){var t=this;try{var n=e.target;if(n)if("mousedown"===e.type)n.$mousedownTimeStamp=e.timeStamp,n.$mouseEventX=e.offsetX,n.$mouseEventY=e.offsetY;else if("click"===e.type){var i=e.timeStamp-(Number(n.$mousedownTimeStamp)||0),o=Math.abs(e.offsetX-(Number(n.$mouseEventX)||Number.MAX_VALUE)),r=Math.abs(e.offsetY-(Number(n.$mouseEventY)||Number.MAX_VALUE));if(n.$mousedownTimeStamp=0,n.$mouseEventX=Number.MAX_VALUE,n.$mouseEventY=Number.MAX_VALUE,i>1e3&&(o>10||r>10))return}var a=this.eventContainer,s=void 0;e.composedPath().forEach((function(n){void 0===s&&n.hasAttribute("season-topic-content-type")&&(s=n.getAttribute("season-topic-content-type"));var i=b.GetInstance(n);if(i&&i.handleDomEvent||n===a){var o="topic-domevent-".concat(e.type),r={eventName:o,triggerContentType:s,eventTarget:i,originEvent:e,preventDefault:!1,stopPropagation:!1};throw i&&i.fireEvent(o,r),t.env.fireEvent(t.createDomEvent(e.type,r)),r.preventDefault&&e.preventDefault(),r.stopPropagation&&e.stopPropagation(),null}}))}catch(t){null!==t&&this.env.warn("Exception raised when dispatch dom event",e,t)}}}]),n}(c);function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function oe(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ae(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return L(this,n)}}function ce(e,t){ue(e,t),t.add(e)}function le(e,t,n){ue(e,t),t.set(e,n)}function ue(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function pe(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var de="season-topic-focus",he=Symbol("topic.children.group.node"),fe=Symbol("topic.level"),ve=Symbol("topic.direction"),ge=Symbol("topic.fold"),me=new WeakMap,be=new WeakSet,ye=new WeakSet,we=new WeakSet,ke=new WeakSet,xe=new WeakSet,Ee=new WeakSet,Ae=new WeakSet,Se=new WeakSet,Le=new WeakSet,Ne=new WeakSet,Te=new WeakSet,Ce=function(e){A(n,e);var t=se(n);function n(e,i,o,r){var a;y(this,n),ce(x(a=t.apply(this,arguments)),Te),ce(x(a),Ne),ce(x(a),Le),ce(x(a),Se),ce(x(a),Ae),ce(x(a),Ee),ce(x(a),xe),ce(x(a),ke),ce(x(a),we),ce(x(a),ye),ce(x(a),be),le(x(a),me,{writable:!0,value:void 0}),V(x(a),{env:a.$env,handleDomEvent:!0,eventSelectorPrefix:":scope > [season-topic-content-group] > "});var s=M(x(a),me,a.$assignedNode.querySelector(":scope > [season-topic-content-group]"));if(!a.$stubFlag){s.setAttribute("season-topic-content-group",a.id);var c=a[he];if(c&&(c.innerHTML="",c.setAttribute("season-topic-children-group",a.id),i.children instanceof Array)){var l=a[fe]+1;i.children.forEach((function(t){e.generate(c,n,t,l,r)})),delete i.children}}return a}return k(n,[{key:"initMetadata",value:function(e,t,n,i,r){P(r instanceof K,B,-1,"_env must be an instance of MindmapEnvironment"),V(e,"env",r),e[he]=n.querySelector(":scope > [season-topic-children-group]"),e[fe]=Number(i)||0,e[ve]=void 0,e[ge]=!1;var a=t.id,s=null==a;s&&(a=o());try{Object.defineProperty(t,"id",{value:a,writable:!1,configurable:!1,enumerable:!0})}catch(e){if(s)throw e}}},{key:"id",get:function(){return this.data.id}},{key:"level",get:function(){return this[fe]}},{key:"direction",get:function(){return this[ve]}},{key:"parentTopic",get:function(){var e=this.$assignedNode.parentNode,t=e&&e.parentNode;return t&&t.hasAttribute("season-topic-global")?n.GetInstance(t):void 0}},{key:"hasChildren",get:function(){var e=pe(this,ye,Be).call(this);return e&&e.length>0}},{key:"rootTopic",get:function(){return n.getFirstChildTopic(pe(this,be,Me).call(this))}},{key:"firstChildTopic",get:function(){return n.getFirstChildTopic(this)}},{key:"getChildrenTopics",value:function(){return oe(pe(this,ye,Be).call(this)).map((function(e){return n.GetInstance(e)}))}},{key:"enumerateChilrenTopics",value:O.mark((function e(){var t,i,o,r;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=pe(this,ye,Be).call(this),i=t&&t.length,o=0;case 3:if(!(o<i)){e.next=11;break}if(!((r=n.GetInstance(t[o]))instanceof n)){e.next=8;break}return e.next=8,r;case 8:o++,e.next=3;break;case 11:case"end":return e.stop()}}),e,this)}))},{key:"enumerateDescendantTopics",value:O.mark((function e(){var t,i,o,r;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=pe(this,ye,Be).call(this),i=t&&t.length,o=0;case 3:if(!(o<i)){e.next=12;break}if(!((r=n.GetInstance(t[o]))instanceof n)){e.next=9;break}return e.next=8,r;case 8:return e.delegateYield(r.enumerateDescendantTopics(),"t0",9);case 9:o++,e.next=3;break;case 12:case"end":return e.stop()}}),e,this)}))},{key:"enumerateTopics",value:O.mark((function e(){return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this;case 2:return e.delegateYield(this.enumerateDescendantTopics(),"t0",3);case 3:case"end":return e.stop()}}),e,this)}))},{key:"nextSiblingTopic",get:function(){for(var e=this.$assignedNode.nextSibling;e;e=e.nextSibling){var t=n.GetInstance(e);if(t instanceof n)return t}return null}},{key:"previousSiblingTopic",get:function(){for(var e=this.$assignedNode.previousSibling;e;e=e.previousSibling){var t=n.GetInstance(e);if(t instanceof n)return t}return null}},{key:"getTopicByID",value:function(e){return String(this.id)===String(e)?this:n.getTopicByID(this.$assignedNode,e)}},{key:"topicNode",get:function(){return this.$assignedNode}},{key:"exportTopicData",value:function(e){var t=j({},this.data);e&&delete t.id;var n,i=[],o=re(this.enumerateChilrenTopics());try{for(o.s();!(n=o.n()).done;){var r=n.value;i.push(r.exportTopicData())}}catch(e){o.e(e)}finally{o.f()}return i.length>0&&(t.children=i),t}},{key:"collectImageStorage",value:function(){try{var e=this.$assignedNode.ownerSVGElement.querySelector("[season-topic-image-storage]"),t=pe(this,be,Me).call(this);if(e&&t){var n=e.querySelectorAll(":scope > *");n&&n.forEach((function(e){var n=e.getAttribute("id");n&&t.querySelector('use[href="#'.concat(n,'"]'))||e.remove()}))}}catch(e){this.env.warn("Fail in collecting the images in the storage",e)}}},{key:"enumerateImageInStorage",value:O.mark((function e(){var t,n,i,o,r,a;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(t=this.$assignedNode.ownerSVGElement.querySelector("[season-topic-image-storage]"))){e.next=22;break}n=oe(t.querySelectorAll(":scope > *")),i=re(n),e.prev=5,i.s();case 7:if((o=i.n()).done){e.next=14;break}return r=o.value,a=r.querySelector(":scope > image"),e.next=12,{id:r.getAttribute("id"),href:a&&a.getAttribute("href"),width:r.$width||Number(r.getAttribute("width"))||0,height:r.$height||Number(r.getAttribute("height"))||0,sourceURL:r.getAttribute("d-url"),sourceHRef:r.getAttribute("d-href")};case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(0),this.env.warn("Fail in enumerating the images in the storage",e.t1);case 27:case"end":return e.stop()}}),e,this,[[0,24],[5,16,19,22]])}))},{key:"showInCenterOfView",value:function(){var e=C(this,me).getBBox(),t=e.width,n=e.height,i=C(this,me).getCTM(),o=i.e/i.a,r=i.f/i.d,a=C(this,me).ownerSVGElement,s=a.viewBox.baseVal||{x:0,y:0,width:0,height:0},c=s.x,l=s.y,u=s.width,p=s.height;return u<=0&&(u=a.width.baseVal.value),p<=0&&(p=a.height.baseVal.value),o=parseInt(o+t/2),r=parseInt(r+n/2),c-=parseInt(u/2)-o,l-=parseInt(p/2)-r,a.setAttribute("viewBox","".concat(c," ").concat(l," ").concat(u," ").concat(p)),this.notify("topic-event-view-move"),this}},{key:"showInView",value:function(){return n.showNodeInSvgView(C(this,me),this.$assignedNode.ownerSVGElement),this.notify("topic-event-view-move"),this}},{key:"notify",value:function(e,t){return"object"===S(t)?t.eventTarget=this:t={eventTarget:this},this.fireEvent(e,t),this.env.fireEvent(e,t),this}},{key:"on-ebevent-rendering",value:function(e,t,i,o,r){var a=this,s=this[fe];this.$assignedNode.setAttribute("season-topic-global",e.id),this.$assignedNode.setAttribute("d-topic-level",s),s>0&&(this[ve]=o);var c=C(this,me);c.setAttribute("d-topic-id",e.id),c.setAttribute("d-topic-level",s);var l=c.querySelector(".season-topic-title");l&&((l.textContent=e.title)||(l.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"));var u=l.getBBox(),p=u.width,d=u.height,h=c.querySelector("[season-topic-extends]");pe(this,Ne,je).call(this,h,r,e,this,i,o);var f,v,g=h.getBBox(),m=g.width,b=g.height,y=0,w=0,k=e.image&&this.env.translateHRefToURL(e.image.src);k?(v=this.acquireNode(":scope > [season-topic-content-group] > .season-topic-image",C(this,me),"beforeend"),y=Number(e.image.width)||Math.max(p,Number(r.suitableTitleLineWidth)||K.DefaultConfig.suitableTitleLineWidth),(w=Number(e.image.height)||0)||(w=y/4*3),v?(v.setAttribute("width",y),v.setAttribute("height",w),pe(this,Le,Oe).call(this,k.destination,k.source,v,y,w,r),f=2*r.padding+w):f=r.padding):((v=this.acquireNode(":scope > [season-topic-content-group] > .season-topic-image"))&&v.remove(),v=void 0,f=r.padding);var x,E,A=p+(m>0?r.padding+m:0),S=Number(r.suitableTitleLineWidth)||K.DefaultConfig.suitableTitleLineWidth;A>y&&(p>S||m>S)&&m>p?(x=Math.max(p,y,m),l.setAttribute("transform","translate(".concat(p>=x?r.padding:r.padding+(x-p)/2,", ").concat(f,")")),h.setAttribute("transform","translate(".concat(m>=x?r.padding:r.padding+(x-m)/2,", ").concat(f+=r.padding+d,")")),f+=b):(A<y?(E=r.padding+(y-A)/2,x=y):(E=r.padding,x=A),l.setAttribute("transform","translate(".concat(E,", ").concat(f,")")),h.setAttribute("transform","translate(".concat(E+r.padding+p,", ").concat(f,")")),f+=Math.max(d,b));v&&v.setAttribute("transform","translate(".concat(y>=x?r.padding:r.padding+(x-y)/2,", ").concat(r.padding,")"));var L=c.querySelector(".season-topic-box"),N=t.contentWidth=2*r.padding+x,T=t.contentHeight=r.padding+f;if(L){L.setAttribute("href","#".concat(r.topicBoxRefID||"topic-default-box")),L.setAttribute("width",N),L.setAttribute("height",T);var M=L.style;M.setProperty("--topic-rect-width","".concat(N,"px")),M.setProperty("--topic-rect-height","".concat(T,"px"))}var B,D=t.childrenNodes=pe(this,ye,Be).call(this);if(s>0&&D&&D.length>0){B=!(i>s||(isNaN(i)||i<=0)&&!this[ge]),this[ge]=B;var z=this.acquireNode(':scope > [season-topic-content-group] > [season-topic-content-type="fold"]',C(this,me),"beforeend");if(z){z.setAttribute("href",B?"#topic-fold-icon-plus":"#topic-fold-icon-minus"),c.insertAdjacentElement("beforeend",z);var R=z.getBBox(),I=R.width,q=R.height;z.setAttribute("transform","translate(".concat(o?N-I/2:0-I/2,", ").concat((T-q)/2,")"))}}else{B=this[ge]=!1;var $=this.acquireNode(':scope > [season-topic-content-group] > [season-topic-content-type="fold"]');$&&$.remove()}var O=this[he];if(B)O&&O.remove();else try{O&&O.isConnected||this.$assignedNode.insertAdjacentElement("afterbegin",O);var P=t.dirIndexThresold=parseInt((D.length+1)/2),j=t.rightPriority="left"!==String(r.directionPriority).toLowerCase();D.forEach((function(e,t){var r=n.GetInstance(e);r&&pe(r,Te,Ve).call(r,i,a[fe]<=0?j^t>=P:o)}))}catch(e){console.error("Exception raised in rendering children",e)}}},{key:"on-ebevent-rendered",value:function(e,t,i,o,r){var a=t.childrenNodes,s=this[he];if(a&&a.length>0&&s){var c,l;this.level+1>=r.secondaryTopicLevel?(c=r.secondarySiblingMargin,l=r.secondaryLevelMargin):(c=r.siblingMargin,l=r.levelMargin);var u=t.contentWidth,p=t.contentHeight;if(this[fe]<1){var d={itemList:[],_config:r,siblingMargin:c,levelMargin:l,contentWidth:u,listHeight:0},h={itemList:[],_config:r,siblingMargin:c,levelMargin:l,contentWidth:u,listHeight:0},f=t.dirIndexThresold,v=t.rightPriority;a.forEach((function(e,t){var i=n.GetInstance(e);i&&(v^t>=f?pe(i,we,De).call(i,h):pe(i,ke,ze).call(i,d))})),d.listHeight-=c,h.listHeight-=c,pe(this,xe,Re).call(this,d,h),pe(this,Ee,Ie).call(this,h),pe(this,Ee,Ie).call(this,d);var g=(h.listHeight>=d.listHeight?h.listHeight:d.listHeight)/2;pe(this,Ae,qe).call(this,h,s,g),pe(this,Ae,qe).call(this,d,s,g)}else if(!this[ge]){var m={itemList:[],_config:r,siblingMargin:c,levelMargin:l,contentWidth:u,listHeight:0};o?t.childrenNodes.forEach((function(e){var t=n.GetInstance(e);t&&pe(t,we,De).call(t,m)})):t.childrenNodes.forEach((function(e){var t=n.GetInstance(e);t&&pe(t,ke,ze).call(t,m)})),m.listHeight-=c,pe(this,Ee,Ie).call(this,m);var b=m.listHeight/2;pe(this,Ae,qe).call(this,m,s,b)}var y=s.getBBox(),w=y.y,k=y.height;s.setAttribute("transform","translate(0, ".concat((p-(k+w))/2,")"))}}},{key:"render",value:function(){var e;return this.env.fireEvent("topic-event-before-render"),pe(e=this[fe]<1?this:this.rootTopic,Te,Ve).apply(e,arguments),this.env.fireEvent("topic-event-after-render"),this}},{key:"getFocus",value:function(){return n.getFocusTopic(pe(this,be,Me).call(this))}},{key:"killFocus",value:function(){return(this.$assignedNode.hasAttribute(de)||C(this,me).hasAttribute(de))&&(this.notify("topic-event-cancel-edit"),this.notify("topic-event-kill-focus"),this.$assignedNode.removeAttribute(de),C(this,me).removeAttribute(de)),this}},{key:"setFocus",value:function(e){var t=this.getFocus();return this.equal(t)?!e&&this:(t instanceof n&&t.killFocus(),this.$assignedNode.setAttribute(de,"true"),C(this,me).setAttribute(de,"true"),this.notify("topic-event-set-focus"),!!e||this)}},{key:"hasFocus",get:function(){return this.$assignedNode.hasAttribute(de)}},{key:"createChild",value:function(e,t,i){var o=this.factor.generate(this[he],n,e,this[fe]+1,this.env);return o&&(t instanceof n&&this.equal(t.parentTopic)&&t.$assignedNode.insertAdjacentElement("beforebegin",o.$assignedNode),!i&&o.notify("topic-event-change",{action:"create"})),o}},{key:"changeData",value:function(e,t,n){if(e){var i=n||j({},this.data);void 0===t?delete this.data[e]:this.data[e]=t,!n&&this.notify("topic-event-change",{action:"changeData",key:e,originValue:i})}return this}},{key:"moveTo",value:function(e,t,i){if(e instanceof n){var o=this.parentTopic,r=this.nextSiblingTopic;if(!n.equal(o,e)){var a=this.$assignedNode.parentNode,s=a&&a.querySelector('path[d-topic-id="'.concat(this.id,'"]'));s&&s.remove()}t&&n.equal(t.parentTopic,e)?t.$assignedNode.insertAdjacentElement("beforebegin",this.$assignedNode):e[he]&&e[he].insertAdjacentElement("beforeend",this.$assignedNode),pe(this,Se,$e).call(this,e[fe]+1),!i&&this.notify("topic-event-change",{action:"move",originParent:o,originSibling:r})}else this.env.warn("No effect if the _parentTopic is not an instance of Topic");return this}},{key:"drop",value:function(e,t){var n;if(this.level>0||"function"==typeof e&&e(n=parseInt(100*Math.random()))===n+1){this.level>0&&!t&&this.notify("topic-event-change",{action:"drop"}),this.killFocus();var i,o=re(this.enumerateDescendantTopics());try{for(o.s();!(i=o.n()).done;){var r=i.value;r[he]=void 0,r.unmount()}}catch(e){o.e(e)}finally{o.f()}var a=this.parentTopic;if(a){var s=a[he].querySelector('path[d-topic-id="'.concat(this.id,'"]'));s&&s.remove()}this[he]=void 0,this.unmount()}}},{key:"getRect",value:function(e){var t=e?C(this,me).querySelector(e):C(this,me).querySelector(".season-topic-box")||C(this,me);return t&&t.getBoundingClientRect()||new DOMRect}},{key:"getBBox",value:function(e){var t=e?C(this,me).querySelector(e):C(this,me).querySelector(".season-topic-box")||C(this,me);return t instanceof SVGGraphicsElement&&t.getBBox()||{x:0,y:0,width:0,height:0}}},{key:"getGraphicRect",value:function(e){var t=e?C(this,me).querySelector(e):C(this,me).querySelector(".season-topic-box")||C(this,me);if(t instanceof SVGGraphicsElement){var n=t.getCTM()||t.getScreenCTM(),i=t.getBBox(),o=C(this,me).ownerSVGElement.getScreenCTM().inverse().translate(n.e,n.f),r=o.e,a=o.f,s=n.translate(i.width,i.height),c=s.e,l=s.f;return{x:r,y:a,width:c-=n.e,height:l-=n.f}}return{x:0,y:0,width:0,height:0}}},{key:"getMatrix",value:function(e){var t=e?C(this,me).querySelector(e):C(this,me).querySelector(".season-topic-box")||C(this,me);return t instanceof SVGGraphicsElement&&(t.getCTM()||t.getScreenCTM())||new DOMMatrix([1,0,0,1,0,0])}},{key:"getRectInViewport",value:function(e){var t=e?C(this,me).querySelector(e):C(this,me).querySelector(".season-topic-box")||C(this,me);if(t instanceof SVGGraphicsElement){var n=t.getCTM()||t.getScreenCTM(),i=t.getBBox(),o=n.translate(i.x,i.y),r=n.translate(i.x+i.width,i.y+i.height);return{x:o.e,y:o.f,width:r.e-o.e,height:r.f-o.f}}return{x:0,y:0,width:0,height:0}}},{key:"getGlobalRect",value:function(){var e=pe(this,be,Me).call(this);return e?e.getBBox():{x:0,y:0,width:0,height:0}}},{key:"visible",get:function(){return"none"!=this.$assignedNode.style.display},set:function(e){var t=e?"":"none";this.$assignedNode.style.display=t;var n=this.$assignedNode.parentNode.querySelector('path[d-topic-id="'.concat(this.id,'"]'));n&&(n.style.display=t)}},{key:"getExtensionInstance",value:function(e){if(e){var t=void 0;try{var n=C(this,me).querySelector("[season-topic-extends]"),i=n&&n.querySelectorAll(":scope > *");i&&i.forEach((function(n){var i=H.GetInstance(n);if(i&&i.name===e)throw t=i,null}))}catch(t){t&&this.env.warn("Fail in get extension instance of",e,t)}return t}}},{key:"exportImage",value:function(e){var t,n=this.hasFocus;this.env.fireEvent("topic-event-before-render"),n&&this.killFocus();try{e||(e={});var i=this.$assignedNode.ownerSVGElement,o=i.cloneNode(!0),r=o.querySelector("g[season-topic-root-node]");if(r){var a=this.$assignedNode.getBBox(),s=a.x,c=a.y,l=a.width,u=a.height;o.setAttribute("overflow","hidden"),o.setAttribute("width",l),o.setAttribute("height",u),o.setAttribute("viewBox","".concat(s," ").concat(c," ").concat(l," ").concat(u)),o.style.fontSize=getComputedStyle(i)["font-size"],r.innerHTML="";var p=this.$assignedNode.cloneNode(!0);p.removeAttribute("transform"),p.style.transform="",r.appendChild(p),r.querySelectorAll("[season-topic-focus]").forEach((function(e){return e.removeAttribute("season-topic-focus")}));var d='<?xml version="1.0" standalone="no"?>\r\n'+(new XMLSerializer).serializeToString(o);t=this.env.getImageData("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(d),Object.assign({},e,{width:l,height:u}))}}catch(e){t=Promise.resolve(void 0),this.env.warn("Exception raised in export image from topic",e)}return n&&this.setFocus(),this.env.fireEvent("topic-event-after-render"),t}},{key:"on-topic-domevent-click",value:function(e){if(e.preventDefault=!0,this.setFocus(!0))e.triggerContentType=void 0,this.notify("topic-event-trigger",e);else{var t=e.triggerContentType;"fold"===t?(this[ge]=!this[ge],this.render()):(e.extensionInstance=this.getExtensionInstance(t),this.notify("topic-event-trigger",e))}}},{key:"on-topic-domevent-dblclick",value:function(e){e.preventDefault=!0,this.env.editable&&(this.showInView(),this.notify("topic-event-edit",e))}},{key:"on-topic-domevent-mousedown",value:function(e){if(1===e.originEvent.buttons&&!this.env.dragContext&&this.env.editable&&this.env.dragable&&this[fe]>0){var t={sourceTopic:this,parentTopic:this.parentTopic,draging:!1,timeStamp:Date.now()};this.env.dragContext=t}}},{key:"on-topic-domevent-mousemove",value:function(e){var t=this.env.dragContext;if(t&&!t.draging){var n=this.env.config,i=Date.now()-t.timeStamp;(this.hasFocus&&i>=n.dragStartFocusFilterTimer||i>=n.dragStartNoFocusFilterTimer)&&(this.equal(t.sourceTopic)?(this.notify("topic-event-cancel-edit"),e.preventDefault=!0,t.draging=!0,this.factor.prepareDragTipElements(this,t),this.visible=!1):this.factor.clearDragContext(this.env))}}},{key:"on-topic-domevent-mouseover",value:function(e){var t=this,n=this.env.dragContext;n&&n.draging&&!this.equal(n.parentTopic)&&(this.factor.clearDragoverTimer(n),n.dragoverTopic=this,n.dragoverTimer=setTimeout((function(){n.parentTopic=n.dragoverTopic,t.factor.updateDragTipElements(n),t.factor.clearDragoverTimer(n)}),1e3))}},{key:"on-topic-domevent-mouseout",value:function(e){var t=this.env.dragContext;t&&this.equal(t.dragoverTopic)&&this.factor.clearDragoverTimer(t)}}],[{key:"enumerateReferenceResource",value:O.mark((function e(t,i){var o,r,a,s,c,l,u;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof K&&i)){e.next=40;break}if(!i.image||!i.image.src){e.next=4;break}return e.next=4,i.image.src;case 4:o=[];try{t.extensionFactors.forEach((function(e){var n=e.callScript("getReferenceResources",void 0,t,i);n&&(n instanceof Array?o=o.concat(n):o.push(n))}))}catch(e){t.warn("Exception raised in enumerateReferenceResource",e)}r=re(o),e.prev=7,r.s();case 9:if((a=r.n()).done){e.next=15;break}return s=a.value,e.next=13,s;case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:if(!(i.children instanceof Array)){e.next=40;break}c=re(i.children),e.prev=25,c.s();case 27:if((l=c.n()).done){e.next=32;break}return u=l.value,e.delegateYield(n.enumerateReferenceResource(t,u),"t1",30);case 30:e.next=27;break;case 32:e.next=37;break;case 34:e.prev=34,e.t2=e.catch(25),c.e(e.t2);case 37:return e.prev=37,c.f(),e.finish(37);case 40:case"end":return e.stop()}}),e,null,[[7,17,20,23],[25,34,37,40]])}))},{key:"getFirstChildTopic",value:function(e){var t=void 0;if(e instanceof Node)t=e.querySelector(":scope > g[season-topic-global]");else if(e instanceof n){var i=e[he];i&&i.isConnected&&(t=i.querySelector(":scope > g[season-topic-global]"))}return n.GetInstance(t)}},{key:"getMindRootNode",value:function(e){return e instanceof SVGSVGElement?e.querySelector("g[season-topic-root-node]"):e instanceof SVGElement?e.ownerSVGElement.querySelector("g[season-topic-root-node]"):void 0}},{key:"getTopicByID",value:function(e,t){return n.GetInstance(e instanceof Node&&e.querySelector('g[season-topic-global="'.concat(t,'"]')))}},{key:"getFocusTopic",value:function(e){try{if(e instanceof Node){var t=e.querySelector("g[eblock-template][".concat(de,"]"));return n.GetInstance(t)}}catch(e){return null}}},{key:"convertWindowPointToGraphic",value:function(e,t,n){e instanceof SVGSVGElement||(e=e instanceof SVGGraphicsElement&&e.ownerSVGElement);var i=e&&(e.getCTM()||e.getScreenCTM());return i?{x:(i=new DOMMatrix([i.a,i.b,i.c,i.d,0,0]).inverse().translate(t,n)).e,y:i.f}:{x:t,y:n}}},{key:"showNodeInSvgView",value:function(e,t){var i,o,r=e.getBoundingClientRect(),a=t.getBoundingClientRect();o=r.top<a.top?a.top-r.top:r.bottom>a.bottom?Math.max(a.bottom-r.bottom,a.top-r.top):0,i=r.left<a.left?a.left-r.left:r.right>a.right?Math.max(a.right-r.right,a.left-r.left):0;var s=t.viewBox.baseVal||{x:0,y:0,width:0,height:0},c=s.x,l=s.y,u=s.width,p=s.height;u<=0&&(u=t.width.baseVal.value),p<=0&&(p=t.height.baseVal.value);var d=n.convertWindowPointToGraphic(t,i,o);t.setAttribute("viewBox","".concat(c-d.x," ").concat(l-d.y," ").concat(u," ").concat(p))}}]),n}(b);function Me(){return Ce.getMindRootNode(this.$assignedNode)}function Be(){return this[he]&&this[he].querySelectorAll(":scope > g[season-topic-global]")}function De(e){var t=this.$assignedNode,n=t.getBBox(),i=n.y,o=n.height,r={startX:e.contentWidth,endX:e.contentWidth+e.levelMargin,endY:e.listHeight,id:this.data.id,itemOffsetY:i,itemHeight:o,itemNode:t};e.listHeight+=o+e.siblingMargin,e.itemList.push(r)}function ze(e){var t=this.$assignedNode,n=t.getBBox(),i=n.y,o=n.height,r=C(this,me).getBBox(),a=r.x,s=r.width,c={startX:0,endX:0-e.levelMargin,endY:e.listHeight,id:this.data.id,itemOffsetY:i,itemHeight:o,itemContentWidth:s+a,itemNode:t};e.listHeight+=o+e.siblingMargin,e.itemList.push(c)}function Re(e,t){if(e.listHeight>t.listHeight){var n=(e.listHeight-t.listHeight)/2;t.itemList.forEach((function(e){e.endY+=n}))}else if(t.listHeight>e.listHeight){var i=(t.listHeight-e.listHeight)/2;e.itemList.forEach((function(e){e.endY+=i}))}}function Ie(e){e.itemList.forEach((function(e){e.itemNode.setAttribute("transform","translate(".concat(e.itemContentWidth?e.endX-e.itemContentWidth:e.endX,", ").concat(e.endY-e.itemOffsetY,")")),e.endY+=e.itemHeight/2}))}function qe(e,t,n){e.itemList.forEach((function(e){var i=t.querySelector('path[d-topic-id="'.concat(e.id,'"]'));i||(i=document.createElementNS("http://www.w3.org/2000/svg","path"),t.appendChild(i),i.setAttribute("d-topic-id",e.id)),i.setAttribute("class","season-topic-connect-line");var o=(e.endX-e.startX)/2+e.startX;i.setAttribute("d","M".concat(e.startX," ").concat(n,"C").concat(o," ").concat(n," ").concat(o," ").concat(e.endY," ").concat(e.endX," ").concat(e.endY))}))}function $e(e){this[fe]=e;var t=pe(this,ye,Be).call(this),n=e+1;t&&t.forEach((function(e){var t=e&&Ce.GetInstance(e);t instanceof Ce&&pe(t,Se,$e).call(t,n)}))}function Oe(e,t,n,i,o,r){return Pe.apply(this,arguments)}function Pe(){return Pe=z(O.mark((function e(t,n,i,r,a,s){var c,l,u,p,d,h;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(c=this.$assignedNode.ownerSVGElement.querySelector("[season-topic-image-storage]"))){e.next=26;break}if(!(l=c.querySelector('symbol[d-url="'.concat(t,'"]')))){e.next=8;break}i.setAttribute("href","#"+l.getAttribute("id")),e.next=24;break;case 8:return u="storeimg-"+o(),(l=document.createElementNS("http://www.w3.org/2000/svg","symbol")).setAttribute("id",u),l.setAttribute("d-href",n),l.setAttribute("d-url",t),l.setAttribute("preserveAspectRatio","none"),l.setAttribute("width",r),l.setAttribute("height",a),l.setAttribute("viewBox","0 0 ".concat(r," ").concat(a)),l.insertAdjacentHTML("afterbegin",'<use href="#'.concat(s.placeholderImageId||K.DefaultConfig.placeholderImageId,'" width="').concat(r,'" height="').concat(a,'" style="mix-blend-mode:difference;fill:#000;" stroke="none" />')),c.appendChild(l),i.setAttribute("href","#"+u),e.next=22,this.env.getImageData(t,{type:"png"});case 22:(p=e.sent)?(d=p.width,h=p.height,l.setAttribute("width",l.$width=d),l.setAttribute("height",l.$height=h),l.setAttribute("viewBox","0 0 ".concat(d," ").concat(h)),l.innerHTML='<image class="season-topic-image" x="0" y="0" width="'.concat(d,'" height="').concat(h,'" href="').concat(p.data,'" />')):this.env.warn("Fail in loading image",t);case 24:e.next=27;break;case 26:throw"Fail in locating the storage node for images";case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(0),this.env.warn("Exception in loadImageInStorage:",t,e.t0);case 32:case"end":return e.stop()}}),e,this,[[0,29]])}))),Pe.apply(this,arguments)}function je(e,t,n){for(var i=this,o=arguments.length,r=new Array(o>3?o-3:0),a=3;a<o;a++)r[a-3]=arguments[a];if(e&&n){var s={},c=e.querySelectorAll(":scope > *");c&&c.forEach((function(e){var t=H.GetInstance(e);t&&t.name&&(s[t.name]=t)})),c=[],this.env.extensionFactors.forEach((function(t){var o,a=t.$info&&t.$info.name;a in s?o=s[a]:a in n&&(o=t.generate(e,H,n,i)),o&&(o.render.apply(o,r),o.$assignedNode.isConnected&&c.push(o.$assignedNode))}));var l=0;c.forEach((function(e){var t=e.getBBox();e.$width=t.width;var n=e.$height=t.height;l<n&&(l=n)}));var u=Number(t.secondaryPadding)||0,p=0;c.forEach((function(e){e.setAttribute("transform","translate(".concat(p,", ").concat((l-e.$height)/2,")")),p+=e.$width+u}))}}function Ve(){var e=Array.prototype.splice.call(arguments,0);return e[2]||(e[2]=this.env.config),b.prototype.render.apply(this,e),this}function Ge(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return He(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Fe(e){var t=new WeakMap;return V(e,{binding:function(n){if(t.has(n))return t.get(n);var i=e.bind(n);return t.set(n,i),i},deleteBinding:function(e){return t.delete(e)}})}var _e=["top","left","right","bottom"];function We(e,t,n,i){var o=(e-=2*t)/2;i+i>e&&(i=o);var r=o+n-i;r<0&&(r=0);var a=e-r-2*i;return a<0&&(a=0,r=e-2*i),[r,a]}function Ue(e,t){if(e&&t){for(var n=function(t){var n=e["@"+t.type];"function"==typeof n&&n.call(e,t)},i=n.$installed=new Set,o=Object.getPrototypeOf(e);o;){var r,a=Ge(Object.getOwnPropertyNames(o));try{for(a.s();!(r=a.n()).done;){var s=r.value;s.startsWith("@")&&!i.has(s)&&"function"==typeof e[s]&&(i.add(s),t.addEventListener(s.substring(1),n))}}catch(e){a.e(e)}finally{a.f()}o=Object.getPrototypeOf(o)}for(var c in e)c.startsWith("@")&&!i.has(c)&&"function"==typeof e[c]&&(i.add(c),t.addEventListener(c.substring(1),n));return n}}function Xe(e,t){_obj&&e&&t&&t.$installed instanceof Set&&t.$installed.forEach((function(n){e.removeEventListener(n.substring(1),t)}))}
/**
                           * @author season <season-studio@outlook.com>
                           * @license Apache-2.0
                           */function Ye(e){var t=e.target;if(t instanceof SVGGraphicsElement){t instanceof SVGSVGElement||(t=t.ownerSVGElement);var n=t.getScreenCTM().inverse(),i=t.getBoundingClientRect(),o=n.translate(e.clientX-i.x,e.clientY-i.y);return{x:o.e,y:o.f}}return{x:0,y:0}}function Ke(e){e&&(e.dragStubNode&&e.dragStubNode.remove(),e.dragStubNode=void 0,e.dragLine&&e.dragLine.remove(),e.dragLine=void 0)}function Qe(e,t){if(e){var n=e.dragStubNode,i=0,o=0;if(n){var r=t instanceof MouseEvent?Ye(t):{x:n.$x,y:n.$y},a=r.x,s=r.y;n.setAttribute("transform","translate(".concat(a+2,", ").concat(s+2,")")),i=a+1+n.$width/2,o=s+1+n.$height/2,n.$x=a,n.$y=s}var c=e.dragLine;if(c&&e.parentTopic){var l=e.parentTopic.getGraphicRect();c.setAttribute("d","M".concat(l.x+l.width/2," ").concat(l.y+l.height/2,"L").concat(i," ").concat(o))}}}function Ze(e){e&&(e.dragoverTimer&&clearTimeout(e.dragoverTimer),e.dragoverTimer=void 0,e.dragoverTopic=void 0)}function Je(e){if(e){var t=e.dragContext;t&&(Ze(t),Ke(t),t.sourceTopic&&(t.sourceTopic.visible=!0),t.sourceTopic=void 0,e.dragContext=void 0)}}var et=Fe((function(e){var t=e.detail.originEvent,n=this.env.dragContext;0!=(1&t.buttons)?n&&n.draging&&n.sourceTopic&&Qe(n,t):n&&Je(this.env)})),tt=Fe((function(e){var t=e.detail,n=t.originEvent;if(0==(1&n.buttons)){var i=this.env.dragContext;if(i){if(i.draging){t.preventDefault=!0;var o,r=Ye(n),a=i.parentTopic,s=i.sourceTopic;if(a.level>0)for(o=a.firstChildTopic;o;o=o.nextSiblingTopic){var c=o.getGraphicRect();if(!o.equal(s)&&c.y>=r.y)break}else{var l=a.getGraphicRect(),u=l.x+l.width/2,p=r.x>=u,d=!1;for(o=a.firstChildTopic;o;o=o.nextSiblingTopic){var h=o.getGraphicRect();if(p===h.x>=u){if(d=!0,!o.equal(s)&&h.y>=r.y)break}else if(d)break}}b.equal(a,s.parentTopic)&&b.equal(o,s.nextSiblingTopic)||s.moveTo(a,o),s.queueAction((function(){s.render(),s.$assignedNode.ownerSVGElement.focus()}))}Je(this.env)}}})),nt=Fe((function(e){var t=e.detail,n=t.originEvent;"escape"===String(n.key).toLowerCase()&&(Je(this.env),t.preventDefault=!0)})),it=new l((new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs eblock-predefined=""><path id="topic-fold-icon-plus" fill="#fff" fill-opacity="0.8" stroke="#000" stroke-width="1" transform="translate(-3, -1), scale(1.5, 1.5)" d="M1 4A3 3 0 1 0 8 4A3 3 0 1 0 1 4M2.5 4L6.5 4M4.5 2L4.5 6"/><path id="topic-fold-icon-minus" fill="#fff" fill-opacity="0.8" stroke="#000" stroke-width="1" transform="translate(-3, -1), scale(1.5, 1.5)" d="M1 4A3 3 0 1 0 8 4A3 3 0 1 0 1 4M2.5 4L6.5 4"/><pattern id="season-topic-drag-mask" x="0" y="0" width="4" height="4" patternUnits="userSpaceOnUse"><rect x="2" y="0" width="2" height="2" fill="#000" stroke="none"/><rect x="0" y="2" width="2" height="2" fill="#000" stroke="none"/></pattern><style><![CDATA[.topic-box-inner-rect{width:calc(var(--topic-rect-width) - var(--topic-border-size));height:calc(var(--topic-rect-height) - var(--topic-border-size));x: calc(var(--topic-border-size)/2);y: calc(var(--topic-border-size)/2);stroke-width:var(--topic-border-size);rx: var(--topic-box-radius) !important;ry: var(--topic-box-radius) !important;}]]></style><symbol id="topic-default-box" preserveAspectRatio="none"><rect rx="6" ry="6" class="topic-box-inner-rect" pathLength="100"></rect></symbol></defs><style eblock-predefined="">.season-topic-drag-mask{rx: var(--topic-box-radius, 6px);ry: var(--topic-box-radius, 6px);fill:url(#season-topic-drag-mask);fill-opacity:.3;stroke:none}.season-topic-drag-line{fill:none;stroke:#2c3e50;stroke-width:3px;stroke-dasharray:5,5;stroke-opacity:.6}.season-topic-drag-group,[season-topic-root-node]{--topic-base-fill-color:#ff6600;--topic-base-line-color:#ff6600;--topic-base-font-color:#fff}[season-topic-global]{--topic-fill-color:var(--topic-base-fill-color);--topic-font-color:#000;--topic-font-weight:400;--topic-font-size:1em;--topic-line-color:var(--topic-base-line-color);--topic-line-size:2px;--topic-line-dasharray:none;--topic-line-opacity:1;--topic-border-color:var(--topic-line-color);--topic-border-opacity:0.3;--topic-border-size:0.5px;--topic-border-dasharray:1,0.3;--topic-box-opacity:0.01;--topic-box-radius:6px}[season-topic-global] *{outline:0}[season-topic-content-group]{font-size:var(--topic-font-size)}.season-topic-box{fill:var(--topic-fill-color);fill-opacity:var(--topic-box-opacity);stroke:var(--topic-border-color);stroke-opacity:var(--topic-border-opacity);stroke-dasharray:var(--topic-border-dasharray);stroke-width:var(--topic-border-size)}.season-topic-title{alignment-baseline:before-edge;dominant-baseline:text-before-edge;fill:var(--topic-font-color);font-weight:var(--topic-font-weight)}.season-topic-connect-line{fill:none;stroke:var(--topic-line-color);stroke-width:var(--topic-line-size);stroke-opacity:var(--topic-line-opacity);stroke-dasharray:var(--topic-line-dasharray)}[season-topic-content-group][d-topic-level="0"]{--topic-font-size:1.3em;--topic-font-color:#fff;--topic-font-weight:700;--topic-box-opacity:1;--topic-border-size:1.5px;--topic-border-opacity:1;--topic-border-dasharray:none}[season-topic-content-group][d-topic-level="1"]{--topic-font-weight:700;--topic-box-opacity:0.17;--topic-border-size:1px;--topic-border-opacity:0.6;--topic-border-dasharray:none}[season-topic-content-group][season-topic-focus]{--topic-fill-color:var(--topic-base-fill-color);--topic-font-color:var(--topic-base-font-color);--topic-border-color:#F04137;--topic-font-weight:700;--topic-box-opacity:1;--topic-border-opacity:1;--topic-border-size:2px;--topic-border-dasharray:none}</style><g eblock-template="" season-topic-global=""><g season-topic-children-group=""/><g season-topic-content-group="" tabindex="0"><use class="season-topic-box"/><text class="season-topic-title" season-topic-content-type="title"/><use class="season-topic-image" season-topic-content-type="image" href=""/><g season-topic-extends=""/><use href="#" season-topic-content-type="fold"/></g></g></svg>',"image/svg+xml").querySelector("svg"));function ot(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return rt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function at(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}V(it,{getEventPointInGraphic:Ye,clearDragoverTimer:Ze,prepareDragTipElements:function(e,t){if(e instanceof b&&e.$assignedNode instanceof SVGGraphicsElement&&t){var n=e.$assignedNode.ownerSVGElement;if(n){var i=n.querySelector(".season-topic-drag-group");if(!i&&(i=t.dragStubNode=document.createElementNS("http://www.w3.org/2000/svg","g"))){i.setAttribute("class","season-topic-drag-group"),i.setAttribute("season-topic-global",e.$assignedNode.getAttribute("season-topic-global"));var o=e.acquireNode(":scope > [season-topic-content-group]"),r={$width:0,$height:0,$x:0,$y:0};if(o){(o=o.cloneNode(!0)).removeAttribute("season-topic-focus");var a=o.querySelector(".season-topic-box");a&&(a=a.cloneNode())&&(a.setAttribute("class","season-topic-drag-mask"),r.$width=parseInt(a.getAttribute("width"))||0,r.$height=parseInt(a.getAttribute("height"))||0),o.appendChild(a),(a=o.querySelector('[season-topic-content-type="fold"]'))&&a.remove(),i.appendChild(o)}n.appendChild(i),Object.assign(i,r)}var s=n.querySelector(".season-topic-drag-line");s||(s=t.dragLine=document.createElementNS("http://www.w3.org/2000/svg","path"))&&(s.setAttribute("class","season-topic-drag-line"),n.appendChild(s))}}},clearDragTipElements:Ke,updateDragTipElements:Qe,clearDragContext:Je,onFactorRegister:function(e){P(e instanceof c,B,-1,"_container must be an instance of EBlockContainer"),e.enableDomEvent("click"),e.enableDomEvent("dblclick"),e.enableDomEvent("mousedown"),e.enableDomEvent("mousemove"),e.enableDomEvent("mouseover"),e.enableDomEvent("mouseout"),e.enableDomEvent("mouseup"),e.enableDomEvent("keydown"),e.addEventListener("topic-domevent-mousemove",et.binding(e)),e.addEventListener("topic-domevent-mouseup",tt.binding(e)),e.addEventListener("topic-domevent-keydown",nt.binding(e))},onFactorUnregister:function(e){P(e instanceof c,B,-1,"_container must be an instance of EBlockContainer"),e.disableDomEvent("click"),e.disableDomEvent("dblclick"),e.disableDomEvent("mousedown"),e.disableDomEvent("mousemove"),e.disableDomEvent("mouseover"),e.disableDomEvent("mouseout"),e.disableDomEvent("mouseup"),e.disableDomEvent("keydown"),e.removeEventListener("topic-domevent-mousemove",et.binding(e)),e.removeEventListener("topic-domevent-mouseup",tt.binding(e)),e.removeEventListener("topic-domevent-keydown",nt.binding(e)),et.deleteBinding(e),tt.deleteBinding(e),nt.deleteBinding(e)}});var st=new WeakMap,ct=new WeakMap,lt=new WeakMap,ut=new WeakMap,pt=function(){function e(t){y(this,e),at(this,st,{writable:!0,value:void 0}),at(this,ct,{writable:!0,value:void 0}),at(this,lt,{writable:!0,value:void 0}),at(this,ut,{writable:!0,value:void 0}),P(t instanceof K,B,-1,"_env must be an instance of MindmapEnvironment"),V(this,"env",t),M(this,st,{}),M(this,ct,[]),M(this,lt,Ue(this,t)),M(this,ut,!1)}var t;return k(e,[{key:"sheetCount",get:function(){return C(this,ct).length}},{key:"firstSheet",get:function(){return C(this,ct)[_index]}},{key:"getSheetByID",value:function(e){var t;try{C(this,ct).forEach((function(n){e===n.id&&(t=n)}))}catch(e){e&&console.warn(e)}return t}},{key:"switchToSheet",value:function(e,t){var n=this.getSheetByID(e);return n?(t&&this.synchronizeSheetWithView(),this.env.fireEvent("topic-event-view-switch-sheet",{sheet:n})):this.env.warn("sheet[".concat(e,"] no found")),this}},{key:"enumerateSheet",value:O.mark((function e(){var t;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=O.keys(C(this,ct));case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,{index:t,sheet:C(this,ct)[t]};case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"removeSheet",value:function(e,t){var n,i;for(i in t&&this.synchronizeSheetWithView(),C(this,ct))if(C(this,ct)[i].id===e){n=C(this,ct).splice(i,1),M(this,ut,!0),i>0&&(i-=1);break}var o=C(this,ct)[i];return o||(o=j({},this.constructor.DefaultSheetTemplate),this.addSheet(o)),this.env.fireEvent("topic-event-view-switch-sheet",{sheet:o}),n}},{key:"addSheet",value:function(e,t){return e&&(e.id||(e.id=o()),P(!this.getSheetByID(e.id),B,-1,"The id of the sheet had been contained in the document"),isNaN(t)?C(this,ct).push(e):C(this,ct).splice(t,0,e),M(this,ut,!0),this.env.fireEvent("topic-event-sheet-list-changed")),this}},{key:"synchronizeSheetWithView",value:function(){var e={sheets:[],attachments:{}};this.env.fireEvent("topic-event-view-submit",e);var t,n=0,i=ot(e.sheets);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=o.sheetID,a=o.topicData;n++;var s=this.getSheetByID(r);s?s.topic=a:this.addSheet({topic:a})}}catch(e){i.e(e)}finally{i.f()}for(var c in n>0&&M(this,ut,!0),e.attachments)this.hasAttachment(c)||this.setAttachment(c,e.attachments[c]);return this}},{key:"enumerateAttachment",value:O.mark((function e(){var t;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=O.keys(C(this,st));case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,{name:t,data:C(this,st)[t]};case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"removeAttachment",value:function(e){var t=C(this,st)[e];return t instanceof Blob&&t.$url&&URL.revokeObjectURL(t.$url),delete C(this,st)[e],M(this,ut,!0),this}},{key:"getAttachment",value:function(e){return C(this,st)[e]}},{key:"setAttachment",value:function(e,t){return this.removeAttachment(e),C(this,st)[e]=t,M(this,ut,!0),this}},{key:"clearAttachment",value:function(){for(var e in C(this,st)){var t=C(this,st)[e];t instanceof Blob&&t.$url&&URL.revokeObjectURL(t.$url)}return M(this,st,{}),M(this,ut,!0),this}},{key:"hasAttachment",value:function(e){return e in C(this,st)}},{key:"collectAttachments",value:function(){var e=this,t=new Set,n="".concat(this.env.config.resourceScheme,":"),i=n.length;C(this,ct)instanceof Array&&C(this,ct).forEach((function(o){var r,a=ot(Ce.enumerateReferenceResource(e.env,o.topic));try{for(a.s();!(r=a.n()).done;){var s=r.value;String(s).startsWith(n)&&(s=String(s).substring(i)),t.add(s)}}catch(e){a.e(e)}finally{a.f()}})),Object.getOwnPropertyNames(C(this,st)).forEach((function(n){t.has(n)||e.removeAttachment(n)}))}},{key:"newDocument",value:(t=z(O.mark((function e(t){var n,i,r,a,s=arguments;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.clearAttachment(),M(this,ct,[]),n=s.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=s[r];if(a="function"==typeof t&&t.apply(this,i),e.t0=a instanceof Promise,!e.t0){e.next=8;break}return e.next=8,a;case 8:return C(this,ct).length<=0&&M(this,ct,[j({id:o()},this.constructor.DefaultSheetTemplate)]),this.env.fireEvent("topic-event-sheet-list-changed"),this.env.fireEvent("topic-event-view-switch-sheet",{sheet:C(this,ct)[0]}),M(this,ut,!1),e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"saveDocument",value:function(e){return this.env.fireEvent("topic-event-cancel-edit"),this.synchronizeSheetWithView(),"function"==typeof e&&e.apply(this,Array.prototype.slice.call(arguments,1))}},{key:"getThumbImage",value:function(e){this.env.fireEvent("topic-event-cancel-edit");var t={image:void 0,option:{toBlob:e||!1}};return this.env.fireEvent("topic-event-view-export-image",t),t.image instanceof Promise?t.image:Promise.resolve(t.image)}},{key:"dispose",value:function(){Xe(this.env,C(this,lt))}},{key:"dirty",get:function(){return C(this,ut)}},{key:"clearDirtyFlag",value:function(e){var t;"function"==typeof e&&e(t=parseInt(100*Math.random()))===t+1&&M(this,ut,!1)}},{key:"@topic-event-translate-href-url",value:function(e){var t=e.detail;if(t){var n=String(t.source),i=String(this.env.config.resourceScheme||"").length;if(n.startsWith("".concat(this.env.config.resourceScheme,":"))){n=t.source=n.substring(i+1);var o=C(this,st)[n];o instanceof Blob?t.destination=o.$url||(o.$url=URL.createObjectURL(o)):o&&(t.destination=String(o))}}}},{key:"@topic-event-get-href-type",value:function(e){var t=e.detail;t&&String(t.href).startsWith("".concat(this.env.config.resourceScheme,":"))&&(t.type="resource")}},{key:"@topic-event-update-attachment",value:function(e){var t=e.detail;if(t&&t.resource){var n=t.name||o();this.setAttachment(n,t.resource),t.href=this.env.config.resourceScheme+":"+n}}}]),e}();function dt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ht(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return L(this,n)}}function vt(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}$(pt,"DefaultSheetTemplate",{title:"Untitled Sheet",topic:{title:"Main Topic"}}),$(pt,"DefaultTopicTemplate",{title:"New Topic"});var gt=new WeakMap,mt=new WeakMap,bt=new WeakMap,yt=function(e){A(n,e);var t=ft(n);function n(e,i){var o;y(this,n),P(e instanceof pt,B,-1,"_doc must be an instance of MindmapDocument"),vt(x(o=t.call(this,i,e.env)),gt,{writable:!0,value:void 0}),vt(x(o),mt,{writable:!0,value:void 0}),vt(x(o),bt,{writable:!0,value:void 0}),$(x(o),"UIControlMap",{"ctrl+wheel":{action:"zoom-view",args:[{}]},mouseleft:{action:"move-view"},arrowright:{action:"goto-topic-with-direction",args:["right"]},arrowleft:{action:"goto-topic-with-direction",args:["left"]},arrowup:{action:"gotoPreviousSiblingTopic"},arrowdown:{action:"gotoNextSiblingTopic"},f2:{action:"editFocusTopic"},delete:{action:"deleteFocusTopic"},tab:{action:"createChildTopic"},enter:{action:"createSiblingTopic"},home:{action:"gotoRootTopic"}});var r=e.env;return V(x(o),"doc",e),o.enableDomEvent("wheel"),o.enableDomEvent("contextmenu"),it.register(x(o)),M(x(o),mt,void 0),M(x(o),gt,Ue(x(o),r)),M(x(o),bt,{}),r.syncConfig(),o}return k(n,[{key:"dispose",value:function(){Xe(this.doc.env,C(this,gt)),this.disableDomEvent("wheel"),this.disableDomEvent("contextmenu"),ne.prototype.dispose.call(this)}},{key:"sheetID",get:function(){return C(this,mt)}},{key:"rootTopic",get:function(){return Ce.getFirstChildTopic(this.stageContainer)}},{key:"focusTopic",get:function(){return Ce.getFocusTopic(this.stageContainer)}},{key:"getTopicByID",value:function(e){return Ce.getTopicByID(this.stageContainer,e)}},{key:"createChildTopic",value:function(){var e=this.focusTopic;return e&&(e=e.createChild(j({},this.doc.constructor.DefaultTopicTemplate))),e&&e.setFocus().render().showInView().notify("topic-event-edit",{eventTarget:e}),this}},{key:"createSiblingTopic",value:function(){var e=this.focusTopic,t=e&&(e.parentTopic||e);return t&&(e=t.createChild(j({},this.doc.constructor.DefaultTopicTemplate),e.nextSiblingTopic)),e&&e.setFocus().render().showInView().notify("topic-event-edit",{eventTarget:e}),this}},{key:"editFocusTopic",value:function(e){var t=this.focusTopic;return t&&t.showInView().notify("topic-event-edit",{eventTarget:t,triggerContentType:e||"title"}),this}},{key:"deleteFocusTopic",value:function(){var e=this.focusTopic,t=e&&(e.nextSiblingTopic||e.previousSiblingTopic||e.parentTopic);return e&&e.drop(),t&&t.setFocus().render().showInView(),this}},{key:"gotoNextSiblingTopic",value:function(){var e=this.focusTopic;return e&&(e=e.nextSiblingTopic),e&&e.setFocus().showInView(),this}},{key:"gotoPreviousSiblingTopic",value:function(){var e=this.focusTopic;return e&&(e=e.previousSiblingTopic),e&&e.setFocus().showInView(),this}},{key:"gotoParentTopic",value:function(){var e=this.focusTopic;return e&&(e=e.parentTopic),e&&e.setFocus().showInView(),this}},{key:"gotoChildrenTopic",value:function(){var e=this.focusTopic;return e&&(e=e.firstChildTopic),e&&e.setFocus().showInView(),this}},{key:"gotoRootTopic",value:function(){var e=this.rootTopic;return e&&e.setFocus().showInView(),this}},{key:"render",value:function(){var e;return(e=this.rootTopic).render.apply(e,arguments),this}},{key:"exportImage",value:function(e){e||(e={}),this.env.fireEvent("topic-event-cancel-edit");var t=this.focusTopic;t&&t.killFocus();var n=this.stageContainer.getBBox(),i=n.x,o=n.y,r=n.width,a=n.height,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),s.setAttribute("overflow","hidden"),s.setAttribute("width",r),s.setAttribute("height",a),s.setAttribute("viewBox","".concat(i," ").concat(o," ").concat(r," ").concat(a)),s.style.fontSize=getComputedStyle(this.svgElement)["font-size"],s.insertAdjacentHTML("afterbegin",this.svgElement.innerHTML);var c='<?xml version="1.0" standalone="no"?>\r\n'+(new XMLSerializer).serializeToString(s);return t&&t.setFocus(),this.env.getImageData("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(c),Object.assign({},e,{width:r,height:a}))}},{key:"@topic-event-report-configuration",value:function(e){var t=e&&e.detail,n=t&&t.result||{};try{for(var i,o=document.evaluate('./*[local-name(.) = "desc" and @season-topic-parameters]',this.svgElement,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0;i=o.snapshotItem(r++);)try{Object.assign(n,JSON.parse(String(i.textContent).trim()))}catch(e){this.env.warn("Exception raised in parse parameter item",e)}}catch(e){this.env.warn("Exception raised in query parameters",e)}t&&(t.result=n)}},{key:"@topic-event-sync-configuration",value:function(e){try{var t=e&&e.detail,n=this.svgElement.style,i=String(this.svgElement.getAttribute("d-custom-style-props")||"").trim();if(i&&i.split(";").forEach((function(e){(e=e.trim())&&n.removeProperty(e)})),this.svgElement.removeAttribute("d-custom-style-props"),t){var o=[];Object.entries(t).forEach((function(e){var t="--"+String(e[0]||"").replace(/[A-Z]/g,(function(e){return"-"+e.toLocaleLowerCase()}));o.push(t),n.setProperty(t,e[1])})),o.length>0&&this.svgElement.setAttribute("d-custom-style-props",o.join(";"))}}catch(e){this.env.warn("Exception raised in update parameters as the svg custom style value",e)}}},{key:"@topic-event-view-export-image",value:function(e){e&&e.detail&&(e.detail.image=this.exportImage(e.detail.option))}},{key:"@topic-event-view-switch-sheet",value:function(e){if(e.detail){this.env.fireEvent("topic-event-cancel-edit");var t=e.detail&&e.detail.sheet;if(t&&t.id){var n=this.rootTopic;n&&n.drop((function(e){return e+1})),M(this,mt,t.id),n=it.generate(this.stageContainer,Ce,j({},t.topic),0,this.env).render().queueAction((function(){n&&n.showInCenterOfView()}))}}}},{key:"@topic-event-view-submit",value:function(e){var t=this.rootTopic.exportTopicData(),n=e&&e.detail;if(t&&n){var i=n.sheets;if(i instanceof Array&&i.push({sheetID:C(this,mt),topicData:t}),this.rootTopic.collectImageStorage(),n.attachments){var o,r=dt(this.rootTopic.enumerateImageInStorage());try{for(r.s();!(o=r.n()).done;){var a=o.value;n.attachments[a.sourceHRef]=a.href}}catch(e){r.e(e)}finally{r.f()}}}}},{key:"@topic-domevent-mousedown",value:function(e){var t=e&&e.detail,i=t&&t.originEvent;t&&!t.eventTarget&&n.dispatchControlMapAction(i,this)}},{key:"@topic-domevent-mousemove",value:function(e){var t=this,i=e&&e.detail,o=i&&i.originEvent;i&&!i.eventTarget&&(n.dispatchControlMapAction(o,this,(function(e){C(t,bt).type&&C(t,bt).type!==e.action&&(C(t,bt).type=void 0)}))||C(this,bt).type&&(C(this,bt).type=void 0))}},{key:"@topic-domevent-mouseup",value:function(e){var t=e&&e.detail,n=t&&t.originEvent;t&&!t.eventTarget&&C(this,bt).type&&this[C(this,bt).type](n)}},{key:"@topic-domevent-click",value:function(e){var t=e&&e.detail,n=t&&!t.eventTarget&&this.focusTopic&&this.focusTopic;n&&n.killFocus()}},{key:"@topic-domevent-wheel",value:function(e){var t=e&&e.detail,i=t&&t.originEvent;t&&n.dispatchControlMapAction(i,this)}},{key:"@topic-domevent-keydown",value:function(e){var t=e&&e.detail,i=t&&t.originEvent;n.dispatchControlMapAction(i,this)&&(i.preventDefault(),i.stopPropagation())}},{key:"@topic-domevent-contextmenu",value:function(e){var t=e&&e.detail,n=t&&t.originEvent;n.preventDefault(),n.stopPropagation()}},{key:"move-view",value:function(e){if(e instanceof WheelEvent)this.move(e.deltaX,e.deltaY),e.preventDefault(),e.stopPropagation();else if(e instanceof MouseEvent){var t=C(this,bt);if("mousedown"===e.type)t.type="move-view",t.x=e.clientX,t.y=e.clientY,this.svgElement.style.cursor="grabbing";else if("mousemove"===e.type){if("move-view"===t.type){var n=t.x-e.clientX,i=t.y-e.clientY;t.x=e.clientX,t.y=e.clientY;var o=Ce.convertWindowPointToGraphic(this.svgElement,n,i);this.move(o.x,o.y)}e.preventDefault(),e.stopPropagation()}else t.type=null,this.svgElement.style.cursor=""}}},{key:"zoom-view",value:function(e,t){if(t||(t={}),e instanceof WheelEvent){var n="x"===t.by?e.deltaX>0:"z"===t.by?e.deltaZ>0:e.deltaY>0;n=n?this.scale-(Number(t.delta)||.02):this.scale+(Number(t.delta)||.02),this.scale=Math.min(Math.max(n,Number(t.min)||.1),Number(t.max)||2),e.preventDefault(),e.stopPropagation()}else if(e instanceof MouseEvent){var i=C(this,bt);if("mousedown"===e.type)i.type="zoom-view",i.x=e.clientX,i.y=e.clientY,this.svgElement.style.cursor="zoom-in";else if("mousemove"===e.type){if("zoom-view"===i.type){var o="x"===t.by?i.x<e.clientX:i.y<e.clientY;o=o?0-(Number(t.delta)||.02):Number(t.delta)||.02,i.x=e.clientX,i.y=e.clientY,this.svgElement.style.cursor=o>0?"zoom-in":"zoom-out",this.scale=Math.min(Math.max(this.scale+o,Number(t.min)||.1),Number(t.max)||2)}}else i.type=null,this.svgElement.style.cursor="";e.preventDefault(),e.stopPropagation()}}},{key:"goto-topic-with-direction",value:function(e,t){var n="right"===t,i=this.focusTopic;if(i){if(i.level<1){for(i=i.firstChildTopic;i;i=i.nextSiblingTopic)if(i.direction==n){i.setFocus();break}}else i.direction==n?this.gotoChildrenTopic():this.gotoParentTopic();e.preventDefault(),e.stopPropagation()}}}],[{key:"getContrlMapKey",value:function(e,t){var n=[];if(e instanceof UIEvent)if(e.ctrlKey&&n.push(t?"Ctrl":"ctrl"),e.altKey&&n.push(t?"Alt":"alt"),e.shiftKey&&n.push(t?"Shift":"shift"),e.metaKey&&n.push(t?"Meta":"meta"),e instanceof MouseEvent)e instanceof WheelEvent&&n.push("wheel"),0!=(1&e.buttons)&&n.push("mouseleft"),0!=(2&e.buttons)&&n.push("mouseright"),0!=(4&e.buttons)&&n.push("mousemiddle"),0!=(8&e.buttons)&&n.push("mouseback"),0!=(16&e.buttons)&&n.push("mouseforward");else if(e instanceof KeyboardEvent){var i=String(e.key);t?(1===i.length&&i[0]>="a"&&i[0]<="z"&&(i=i.toLocaleUpperCase()),n.push(i)):n.push(i.toLocaleLowerCase())}return n.join("+")}},{key:"dispatchTopicEventAction",value:function(e,t){var n=e instanceof Event?e.detail:e,i=n&&this[n.triggerContentType||"title"],o=i&&i[t||e instanceof Event&&String(e.type).replace(/^topic-event-/gi,"")];return"function"==typeof o&&(o(n),!0)}},{key:"dispatchControlMapAction",value:function(e,t,i){var o=n.getContrlMapKey(e),r=t.UIControlMap[o];if(r){var a,s=r.action;if("function"==typeof s||(s=t[s]),"function"==typeof s)return"function"==typeof i&&i(r),(a=s).call.apply(a,[t,e].concat(oe(r.args||[]))),r}}}]),n}(ne);
/**
                           * @author season <season-studio@outlook.com>
                           * @license Apache-2.0
                           */
function wt(e,t,n){return new F((new DOMParser).parseFromString(e,t||"image/svg+xml").querySelector(n||"svg"))}var kt=[wt('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs eblock-predefined="" d-tag="topic-priority"><symbol id="topic-priority-1" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#f00" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M8 7L10.5 6V16"></path></symbol><symbol id="topic-priority-2" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#f00" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M7 8C10.5 1 20 8 7 14M6 14H16"></path></symbol><symbol id="topic-priority-3" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#f0f" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M7 7C10.5 1 20 8 10 10C21 10 10.5 21 6 12"></path></symbol><symbol id="topic-priority-4" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#f0f" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M12 4Q10 10 6 13M5 13H15M13 8L11 16"></path></symbol><symbol id="topic-priority-5" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#06f" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M9 4Q9 7 8 9M7 9C18 5 16 20 6 14M9 5H14"></path></symbol><symbol id="topic-priority-6" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#06f" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M7 9C13 7 16 13 10 15C4 15 4 9 13 4"></path></symbol><symbol id="topic-priority-7" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#093" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M7 8V6Q11 7 13 6.5Q10 12 9 16"></path></symbol><symbol id="topic-priority-8" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#093" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M10 9C6 8 7 3 12 4C15 5 15 10 10 9C16 10 16 16.5 10 16C4 15 4 9 10 9"></path></symbol><symbol id="topic-priority-9" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#993" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M15 10C6 16 5 3.5 12 4.5C18 6 16 17 7 16"></path></symbol></defs><script eblock-script=""><![CDATA[        declarer.getExtensionInfo = function () {            return {                name: "priority"            };        };        declarer.onRendering = function (_data) {            if (_data) {                let priority = Number(_data.priority);                if (priority && (priority > 0) && (priority < 10)) {                    this.$assignedNode.setAttribute("href", "#topic-priority-" + priority);                } else {                    this.unmount();                }            }        };    ]]><\/script><use eblock-template="" season-topic-content-type="priority" ebevent-rendering="onRendering" width="22" height="22"/></svg>'),wt('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs eblock-predefined="" d-tag="topic-task-marker"><symbol id="topic-task-marker-0" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#fff" fill-opacity="0.8" stroke="#093" stroke-width="1" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M8 14V5L15 10L8 15V6"></path></symbol><symbol id="topic-task-marker-1" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 1 0 16.5 4.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-2" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 1 0 19 10.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-3" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 1 0 16.5 16.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-4" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 0 0 10.5 19L10.5 10.5"></path></symbol><symbol id="topic-task-marker-5" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 0 0 4.5 16.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-6" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 0 0 2 10.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-7" width="20" height="20" viewBox="-1 -1 22 22"><circle cx="10.5" cy="10.5" r="10" stroke="none" fill="#093" fill-opacity="0.8"></circle><path stroke="none" fill="#fff" fill-opacity="0.8" d="M10.5 10.5V2A8.5 8.5 180 0 0 4.5 4.5L10.5 10.5"></path></symbol><symbol id="topic-task-marker-8" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#093" fill-opacity="0.8" stroke="#fff" stroke-width="2" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M15 6L10 13L6 9"></path></symbol><symbol id="topic-task-marker-unknown" width="20" height="20" viewBox="-1 -1 22 22"><path fill="#fff" fill-opacity="0.8" stroke="#093" stroke-width="1" stroke-opacity="0.8" d="M1 10A9 9 0 1 1 20 10A9 9 0 1 1 1 10M7 8A3.5 3.5 0 1 1 10.5 10.5V13M10.5 14V16M9.5 15H11.5"></path></symbol></defs><script eblock-script=""><![CDATA[        declarer.getExtensionInfo = function () {            return {                name: "task-marker"            };        };        declarer.onRendering = function (_data) {            if (_data && ("task-marker" in _data)) {                let task = Number(_data["task-marker"]);                if ((task >= 0) && (task <= 8)) {                    this.$assignedNode.setAttribute("href", "#topic-task-marker-" + task);                } else {                    this.$assignedNode.setAttribute("href", "#topic-task-marker-unknown");                }            } else {                this.unmount();            }        };    ]]><\/script><use eblock-template="" season-topic-content-type="task-marker" ebevent-rendering="onRendering" width="22" height="22"/></svg>'),wt('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style eblock-predefined="" d-tag="topic-href">.season-topic-href{fill:rgba(255,255,255,.05);stroke:none}.season-topic-href>use{fill:var(--topic-font-color)}.season-topic-href:hover{fill:var(--topic-ui-focus-color);fill-opacity:.3;stroke:none}.season-topic-href:hover>use{fill-opacity:1}</style><defs eblock-predefined="" d-tag="topic-href"><symbol id="topic-href-link-icon" width="20" height="20" viewBox="0 0 20 20"><path d="M 19,7.115 13.63,2.5 v 2.692 c -8.226,0.08 -8.339,8.658 -8.339,8.658 0,0 1.746,-4.562 8.339,-4.619 v 2.499 z"></path><path d="M 5 3.625 C 3.892 3.625 3 4.517 3 5.625 L 3 14.62 C 3 15.73 3.892 16.62 5 16.62 L 15.01 16.62 C 16.12 16.62 17.01 15.73 17.01 14.62 L 17.01 10.33 L 15.81 11.35 L 15.81 13.76 C 15.81 14.68 15.07 15.42 14.15 15.42 L 5.857 15.42 C 4.939 15.42 4.199 14.68 4.199 13.76 L 4.199 6.482 C 4.199 5.564 4.939 4.824 5.857 4.824 L 12.49 4.824 L 12.5 3.625 L 5 3.625 z"></path></symbol><symbol id="topic-href-resource-icon" width="20" height="20" viewBox="0 0 20 20"><path d="m 4.407,16.36 c -1.535,-1.53 -1.536,-4.02 -0,-5.55 L 11.87,3.344 c 1.11,-1.125 2.97,-1.125 4.09,0 1.12,1.126 1.12,2.968 0,4.094 L 9.086,14.31 c -0.729,0.73 -1.902,0.73 -2.632,0 -0.731,-0.72 -0.729,-1.9 0,-2.63 L 9.97,8.17 10.84,9.045 7.332,12.56 c -0.245,0.25 -0.247,0.63 0,0.87 0.248,0.25 0.63,0.25 0.876,0 L 15.08,6.56 c 0.65,-0.643 0.65,-1.696 0,-2.34 -0.65,-0.642 -1.7,-0.642 -2.34,0 l -7.457,7.47 c -1.05,1.04 -1.047,2.73 0,3.79 1.052,1.05 2.746,1.05 3.797,0 l 3.08,-3.08 0.88,0.87 -3.08,3.08 c -1.537,1.54 -4.022,1.53 -5.557,0 z"></path></symbol></defs><script eblock-script=""><![CDATA[        declarer.getExtensionInfo = function () {            return {                name: "href"            };        };        declarer.onRendering = function (_data, _, _topic) {            if (!_data || !_data.href) {                this.unmount();            } else {                let type = _topic.env.getHRefType(_data.href);                let node = this.$assignedNode.querySelector(":scope > use");                node && node.setAttribute("href", (type === "link") ? "#topic-href-link-icon" : "#topic-href-resource-icon");            }        };    ]]><\/script><g eblock-template="" season-topic-content-type="href" class="season-topic-href" ebevent-rendering="onRendering"><rect width="20" height="20" rx="3" ry="3"/><use href="#topic-href-link-icon" width="20" height="20"/></g></svg>'),wt('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style eblock-predefined="" d-tag="topic-labels">.season-topic-label>rect{fill:rgba(255,255,255,.7);stroke-width:.5px;stroke-dasharray:2;stroke:#666;rx: 5px;ry: 5px;}.season-topic-label>text{alignment-baseline:before-edge;dominant-baseline:text-before-edge;font-size:.8em;fill:#666}</style><script eblock-script=""><![CDATA[        declarer.getExtensionInfo = function () {            return {                name: "labels"            };        };        declarer.onRendering = function (_data, _, _topic) {            const labels = (_data && _data.labels);            if (!labels || !_data.labels.length) {                this.unmount();            } else {                const renderedLabels = [];                this.$assignedNode.querySelectorAll(".season-topic-label").forEach(item => {                    let labelVal = item.getAttribute("d-label");                    if (!labels.includes(labelVal)) {                        item.remove();                    } else {                        renderedLabels.push(labelVal);                    }                });                labels.forEach(item => {                    if (!renderedLabels.includes(item)) {                        let gNode = document.createElementNS("http://www.w3.org/2000/svg", "g");                        gNode.setAttribute("class", "season-topic-label");                        gNode.innerHTML = \'<text transform="translate(2, 2)">\' + item + \'</text>\';                        this.$assignedNode.appendChild(gNode);                        let box = gNode.getBBox();                        gNode.insertAdjacentHTML("afterbegin", \'<rect x="0" y="0" width="\' + String(parseInt(box.width) + 4) + \'" height="\' + String(parseInt(box.height) + 4) + \'" />\');                    }                });                let x = 0;                this.$assignedNode.querySelectorAll(".season-topic-label").forEach(item => {                    item.setAttribute("transform", "translate(" + x + ",0)");                    let box = item.getBBox();                    x += box.width + 2;                });            }        };    ]]><\/script><g eblock-template="" season-topic-content-type="labels" class="season-topic-labels" ebevent-rendering="onRendering"></g></svg>'),wt('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style eblock-predefined="" d-tag="topic-notes">.season-topic-notes{fill:rgba(255,255,255,.05);stroke:none}.season-topic-notes>use{fill:rgba(255,255,255,.3);stroke-width:1.5px;stroke:#111}.season-topic-notes:hover>use{fill:#fff;stroke-width:1.5px;stroke:#000}</style><script eblock-script=""><![CDATA[        declarer.getExtensionInfo = function () {            return {                name: "notes"            };        };        declarer.onRendering = function (_data, _, _topic) {            if (!_data || !_data.notes) {                this.unmount();            }        };    ]]><\/script><g eblock-template="" season-topic-content-type="notes" class="season-topic-notes" ebevent-rendering="onRendering"><use href="#season-topic-predefine-image-nodepad" width="20" height="20"/></g></svg>')];function xt(e,t,n,i){var o=e.getAttribute("mmap-layout-background"),r=o&&(i[o]||Nt.backgroundGenerator[o]);if("function"==typeof r){var a=e.getBBox(),s=a.x>=0?0:a.x,c=a.y>=0?0:a.y,l=a.width+2*Math.abs(a.x),u=a.height+2*Math.abs(a.y);(t=r.call(this,t,{left:s,top:c,width:l,height:u},e,n,i))&&(t.classList.add("mmap-layout-background"),e.insertAdjacentElement("afterbegin",t))}}function Et(e,t,n){var i=this;e.querySelectorAll(":scope > *").forEach((function(e){return St.call(i,e,t,n)}))}function At(e,t){var n,i,o=(n=e.getAttribute("mmap-layout-max-width"),i=t.maxWidth,Math.min(Number(n)||Number.MAX_VALUE,Number(i)||Number.MAX_VALUE)),r=Number(e.getAttribute("mmap-layout-margin")||void 0);isNaN(r)&&(r=Number(t.margin)||0);var a=Number(e.getAttribute("mmap-layout-padding")||void 0);return isNaN(a)&&(a=Number(t.padding)||0),{maxWidth:o,margin:r,padding:a}}function St(e,t,n){t||(t={});var i=e.querySelector(":scope > .mmap-layout-background");i&&i.remove();var o=e.getAttribute("mmap-layout"),r=Nt.layout[o]||Et;"function"==typeof r&&r.call(this,e,t,n),xt.call(this,e,i,t,n)}var Lt=new WeakMap;function Nt(e,t,n){var i,o=this;if(!(this instanceof Nt))return I(Nt,Array.prototype.slice.call(arguments));if(P(e instanceof SVGGraphicsElement,Error,"_parentNode must be an instance of SVGGraphicsElement"),P(t,Error,"_content must be an instance of Node or a XML snippet of the content"),n||(n={}),n.singletonStamp){var r=e.querySelector(':scope > [mmap-singleton="'.concat(n.singletonStamp,'"]')),a=r&&Lt.get(r);if(a instanceof Nt){if(void 0===n.singletonMutex||String(n.singletonMutex)===r.getAttribute("mmap-singleton-mutex"))return a;a.close()}}if(t instanceof Node?i=t:(i=document.createElementNS("http://www.w3.org/2000/svg","g")).insertAdjacentHTML("afterbegin",t),n.singletonStamp&&(i.setAttribute("mmap-singleton",n.singletonStamp),void 0!==n.singletonMutex&&i.setAttribute("mmap-singleton-mutex",n.singletonMutex)),e.appendChild(i),Lt.set(i,this),n.rootAttrs)for(var s in n.rootAttrs)i.setAttribute(s,n.rootAttrs[s]);var c=function(){i.remove()}.bind(this),l=function(){e.appendChild(i),"relayout"===i.getAttribute("mmap-bind-hide-in-render")&&this.relayout()}.bind(this),u=function(e){var t=this;try{e.composedPath().forEach((function(o){var r=o.getAttribute("mmap-event-click"),a=r&&n[r];if("function"==typeof a)throw a.call(t,e,o,n,r),e.preventDefault(),e.stopPropagation(),null;if(o===i)throw e.preventDefault(),e.stopPropagation(),null}))}catch(e){e&&console.warn("Fail in processing click event in MindmapAddinPanel",e)}}.bind(this),p=function(e){var t=this;try{e.composedPath().forEach((function(o){var r=o.getAttribute("mmap-event-dblclick"),a=r&&n[r];if("function"==typeof a)throw a.call(t,e,o,n,r),e.preventDefault(),e.stopPropagation(),null;if(o===i)throw e.preventDefault(),e.stopPropagation(),null}))}catch(e){e&&console.warn("Fail in processing dblclick event in MindmapAddinPanel",e)}}.bind(this),d=function(e){var t=this;try{e.composedPath().forEach((function(o){var r=o.getAttribute("mmap-event-keydown"),a=r&&n[r];if("function"==typeof a)throw a.call(t,e,o,n,r),null;if(o===i)throw"input"!==String(e.target.nodeName).toLowerCase()&&!Boolean(e.target.getAttribute("contenteditable"))&&e.preventDefault(),null}))}catch(e){e&&console.warn("Fail in processing dblclick event in MindmapAddinPanel",e)}finally{e.stopPropagation()}}.bind(this),h=function(e){var t=e.detail,n=t&&t.triggerContentType,o=i.getAttribute("topic-event-trigger"===e.type?"mmap-bind-filter-trigger":"mmap-bind-filter-edit");(o?n!==o:n&&"title"!==n)&&this.close()}.bind(this);function f(e){e.stopPropagation()}function v(e){e.stopPropagation()}var g=function(){"function"==typeof n.onClose&&n.onClose.call(this,n),n.env&&(n.env.removeEventListener("topic-event-cancel-edit",g),n.env.removeEventListener("topic-event-before-render",c),n.env.removeEventListener("topic-event-after-render",l),n.env.removeEventListener("topic-event-trigger",h),n.env.removeEventListener("topic-event-edit",h)),i.removeEventListener("click",u),i.removeEventListener("dblclick",p),i.removeEventListener("mousedown",f),i.removeEventListener("mouseup",v),i.removeEventListener("keydown",d);var t=i.ownerSVGElement;t?t.focus():e.focus(),i.remove()}.bind(this);V(this,{rootNode:i,relayout:function(){"function"==typeof n.onBeforeLayout&&n.onBeforeLayout.call(o,n),St.call(o,i,void 0,n),"function"==typeof n.onAfterLayout&&n.onAfterLayout.call(o,n)},close:g}),i.addEventListener("click",u),i.addEventListener("dblclick",p),i.addEventListener("mousedown",f),i.addEventListener("mouseup",v),i.addEventListener("keydown",d),n.env&&(i.hasAttribute("mmap-bind-cancel-edit")&&n.env.addEventListener("topic-event-cancel-edit",g),i.hasAttribute("mmap-bind-hide-in-render")&&(n.env.addEventListener("topic-event-before-render",c),n.env.addEventListener("topic-event-after-render",l)),i.hasAttribute("mmap-bind-filter-trigger")&&n.env.addEventListener("topic-event-trigger",h),i.hasAttribute("mmap-bind-filter-edit")&&n.env.addEventListener("topic-event-edit",h)),"function"==typeof n.onInitialize&&n.onInitialize.call(this,n),this.relayout()}var Tt="fill:#fff;stroke-width:0.5px;stroke:#ccc;filter:drop-shadow(0px 3px 5px #aaa);";function Ct(e,t){if(t.attrs)for(var n in t.attrs)e.setAttribute(n,t.attrs[n]);if(t.style)for(var i in t.style)e.style[i]=t.style[i]}function Mt(e){return new Promise(((t,n)=>{try{const i=document.createElement("input");i.type="file",e&&(i.accept=e),i.addEventListener("change",(()=>{const e=i.files;e.length>0?t(e[0]):n(0)})),i.click()}catch(e){n(e)}}))}V(Nt,{layout:V({},{line:function(e,t,n){var i=this,o=At(e,t),r=o.maxWidth,a=o.margin,s=o.padding,c=s,l=s,u=0;e.querySelectorAll(":scope > *").forEach((function(e){if(St.call(i,e,o,n),e instanceof SVGGraphicsElement){var t=e.getBBox(),p=t.width,d=t.height;if(p>0){var h=e.getAttribute("predefine-transform");c+p+s>r?(c=s,l+=u+a,u=d):u<d&&(u=d),e.setAttribute("transform",h?"translate(".concat(c,",").concat(l,"),").concat(h):"translate(".concat(c,",").concat(l,")")),c+=p+a}}}))},row:function(e,t,n){var i=this,o=At(e,t),r=o.margin,a=o.padding,s=[],c=a,l=a;e.querySelectorAll(":scope > *").forEach((function(e){if(St.call(i,e,o,n),e instanceof SVGGraphicsElement){var t=e.getBBox(),a=t.width,u=t.height;if(a>0&&u>0){if("right"===e.getAttribute("mmap-layout-align"))s.push({y:c,node:e,width:a});else{var p=e.getAttribute("predefine-transform");e.setAttribute("transform",p?"translate(".concat(l,",").concat(c,"),").concat(p):"translate(".concat(l,",").concat(c,")"))}c+=u+r}}}));var u=e.getBBox().width;s.forEach((function(e){var t=e.node.getAttribute("predefine-transform");e.node.setAttribute("transform",t?"translate(".concat(u-e.width,",").concat(e.y,"),").concat(t):"translate(".concat(u-e.width,",").concat(e.y,")"))}))}}),InstanceMap:Lt,backgroundGenerator:V({},{dialogBubble:function(e,t,n,i,o,r){var a=t.left,s=t.top,c=t.width,l=t.height;return e instanceof SVGPathElement||(e&&e.remove(),e=document.createElementNS("http://www.w3.org/2000/svg","path")),e&&(r||(r={}),e.setAttribute("d",function(e,t,n,i,o,r,a,s,c){_e.includes(c)||(c="top");var l=[];if(l.push("M".concat(e+o," ").concat(t)),"top"===c){var u=We(n,o,s,a);u[0]>0&&l.push("h".concat(u[0])),l.push("l".concat(a," ").concat(0-r,"l").concat(a," ").concat(r)),u[1]>0&&l.push("h".concat(u[1]))}else l.push("h".concat(n-2*o));if(l.push("a".concat(o," ").concat(o," 0 0 1 ").concat(o," ").concat(o)),"right"===c){var p=We(i,o,s,a);p[0]>0&&l.push("v".concat(p[0])),l.push("l".concat(r," ").concat(a,"l").concat(0-r," ").concat(a)),p[1]>0&&l.push("v".concat(p[1]))}else l.push("v".concat(i-2*o));if(l.push("a".concat(o," ").concat(o," 0 0 1 ").concat(0-o," ").concat(o)),"bottom"===c){var d=We(n,o,s,a);d[1]>0&&l.push("h".concat(0-d[1])),l.push("l".concat(0-a," ").concat(r,"l").concat(0-a," ").concat(0-r)),d[0]>0&&l.push("h".concat(0-d[0]))}else l.push("h".concat(0-n+2*o));if(l.push("a".concat(o," ").concat(o," 0 0 1 ").concat(0-o," ").concat(0-o)),"left"===c){var h=We(i,o,s,a);h[1]>0&&l.push("v".concat(0-h[1])),l.push("l".concat(0-r," ").concat(0-a,"l").concat(r," ").concat(0-a)),h[0]>0&&l.push("v".concat(0-h[0]))}else l.push("v".concat(0-i+2*o));return l.push("a".concat(o," ").concat(o," 0 0 1 ").concat(o," ").concat(0-o,"z")),l.join("")}(a,s,c,l,Number(r.cornerRadius)||7,Number(r.raiseHeight)||10,Number(r.raiseBase)||10,Number(r.raiseOffset)||0,r.raiseEdge)),e.setAttribute("style",Tt),Ct(e,r)),e},roundRect:function(e,t,n,i,o,r){var a=t.left,s=t.top,c=t.width,l=t.height;return e instanceof SVGRectElement||(e&&e.remove(),e=document.createElementNS("http://www.w3.org/2000/svg","rect")),e&&(e.setAttribute("style",Tt),e.setAttribute("rx",Number(r&&r.cornerRadius)||7),e.setAttribute("ry",Number(r&&r.cornerRadius)||7),e.setAttribute("x",a),e.setAttribute("y",s),e.setAttribute("width",c),e.setAttribute("height",l),Ct(e,r)),e},auto:function(e){function t(t,n,i,o,r,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i,o,r){var a=t.left,s=t.top,c=t.width,l=t.height;if(e instanceof SVGRectElement||(e&&e.remove(),e=document.createElementNS("http://www.w3.org/2000/svg","rect")),e){r||(r={});var u=n.hasAttribute("d-auto-background")&&JSON.parse("{".concat(String(n.getAttribute(d-auto-background)).replace("'",'"'),"}"));u&&(r=Object.assign(u,r)),e.setAttribute("x",a),e.setAttribute("y",s),e.setAttribute("width",c),e.setAttribute("height",l),Ct(e,r)}return e}))})});var Bt={rootAttrs:{"mmap-layout":"line","mmap-layout-margin":"0","mmap-layout-padding":"5","mmap-layout-background":"dialogBubble","mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"href","mmap-bind-filter-trigger":"href"},singletonStamp:"topic-href-editor",onInitialize:function(e){var t=this.inputNode=this.rootNode.querySelector(".season-topic-href-editor");t&&e.topic instanceof Ce&&(t.value=e.topic.data.href||"",t.select())},onAfterLayout:function(e){var t=this.rootNode.getBBox(),n=e.topic.getGraphicRect();this.rootNode.setAttribute("transform","translate(".concat(n.x+(n.width-t.width)/2,", ").concat(n.y+n.height+11,")")),Ce.showNodeInSvgView(this.rootNode,this.rootNode.ownerSVGElement),this.inputNode.focus()},browser:function(e,t,n,i){var o=this;return z(O.mark((function e(){var t,i;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Mt();case 3:(t=e.sent)instanceof Blob&&(i={name:(n.env.config.defaultResourceAttachmentPrefix||"")+t.name,resource:t},n.env.fireEvent("topic-event-update-attachment",i),i.href&&(o.inputNode.value=i.href),o.close()),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.env.warn("Fail in pickup file as the attachment of the topic",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},delete:function(e,t,n,i){this.inputNode.value="",this.close()},onClose:function(e){var t=e.topic;if(t instanceof Ce){var n=String(this.inputNode.value).trim();n!==t.data.href&&(t.changeData("href",n||void 0),t.queueAction((function(){return t.render()})))}}};function Dt(e){return zt.apply(this,arguments)}function zt(){return(zt=z(O.mark((function e(t){var n,i,o,r,a,s,c,l,u;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mt(".jpg,.jpeg,.png,.gif,.ico,.bmp,.svg");case 2:if(!((n=e.sent)instanceof Blob)){e.next=24;break}if(i={name:(t.env.config.defaultResourceAttachmentPrefix||"")+n.name,resource:n},t.env.fireEvent("topic-event-update-attachment",i),!i.href){e.next=24;break}if(!(o=t.data.image)){e.next=12;break}t.changeData("image",{src:i.href,width:o.width,height:o.height}),e.next=23;break;case 12:return r=t.env.config,a=t.getRect().width-2*r.padding,s=Math.max(a,Number(r.suitableTitleLineWidth)||K.DefaultConfig.suitableTitleLineWidth),(c=new Image).src=URL.createObjectURL(n),e.next=19,c.decode();case 19:URL.revokeObjectURL(c.src),l=c.width,u=c.height,l>s&&(u=u/l*s,l=s),t.changeData("image",{src:i.href,width:l,height:u});case 23:t.queueAction((function(){return t.render()}));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(){return(Rt=z(O.mark((function e(t){var n;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.force){e.next=5;break}return P((n=t.eventTarget)instanceof Ce,B,-1,"Cannot invoke the image edit action without an instance of Topic"),e.next=5,Dt(n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t){if(e&&t instanceof Node){var n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("class","season-topic-label-edit-item"),n.setAttribute("d-label",e),n.innerHTML="<text>".concat(e,"</text>"),t.appendChild(n);var i=n.getBBox(),o=i.width,r=i.height;n.insertAdjacentHTML("afterbegin",'<rect x="0" y="0" width="'.concat(o+r,'" height="').concat(r,'" />')),n.insertAdjacentHTML("beforeend",'<g class="season-topic-label-edit-delete" transform="translate('.concat(o,',0)" mmap-event-click="delete">\n            <rect x="0" y="0"  width="').concat(r,'" height="').concat(r,'" />\n            <use href="#season-topic-predefine-image-cross" width="').concat(r,'" height="').concat(r,'" />\n        </g>'))}}var qt={rootAttrs:{"mmap-layout":"row","mmap-layout-margin":"5","mmap-layout-padding":"10","mmap-layout-background":"dialogBubble","mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"labels","mmap-bind-filter-trigger":"labels"},singletonStamp:"topic-labels-editor",onInitialize:function(e){var t=e.topic instanceof Ce&&e.topic.data.labels;t=Array.from(t instanceof Array?t:[]),this.labels=t;var n=this.rootNode.querySelector(".season-topic-labels-edit-list");t.forEach((function(e){return It(e,n)}))},onAfterLayout:function(e){var t=this.rootNode.getBBox(),n=e.topic.getGraphicRect();this.rootNode.setAttribute("transform","translate(".concat(n.x+(n.width-t.width)/2,", ").concat(n.y+n.height+11,")")),Ce.showNodeInSvgView(this.rootNode,this.rootNode.ownerSVGElement)},onInputKeydown:function(e,t,n){var i=e.target;if(i){var o=String(e.key).toLowerCase();if("enter"===o){o=void 0;var r=String(i.value).trim();this.labels.includes(r)||(i.value="",this.labels.push(r),It(r,this.rootNode.querySelector(".season-topic-labels-edit-list")),this.relayout())}else"tab"===o?o=void 0:"escape"===o&&(o=void 0,i.value="");o||(e.preventDefault(),e.stopPropagation())}},onClose:function(e){var t=e.topic;if(t instanceof Ce){var n=this.labels;String(n)!==String(t.data.labels)&&(t.changeData("labels",n.length>0?n:void 0),t.queueAction((function(){return t.render()})))}},delete:function(e,t,n){for(;t&&!t.hasAttribute("d-label");)(t=t.parentNode)===this.rootNode&&(t=void 0);if(t&&this.labels){var i=t.getAttribute("d-label"),o=this.labels.indexOf(i);o>=0&&this.labels.splice(o,1),t.remove(),this.relayout()}}};var $t="<p><br /></p>";var Ot=[{key:"bold",tag:"b"},{key:"underline",tag:"u"},{key:"italic",tag:"i"},{key:"code",tag:"code"},{key:"color",tag:"span",formatter:function(e){return' style="color:'.concat(e.color,';"')}}],Pt={"<":"&lt;",">":"&gt;"};function jt(e){return Pt[e]||"&nbsp;"}var Vt={bullet:{prefix:"<ul>",tag:"li",suffix:"</ul>"},ordered:{prefix:"<ol>",tag:"li",suffix:"</ol>"}};function Gt(e,t){var n,i=[],o=[];i.push(o),t.ops instanceof Array&&t.ops.forEach((function(e){if(e){var t=e.attributes;String(e.insert||"").split("\n").forEach((function(e,n){var r,a,s,c;n>0&&(o.$type=t&&t.list,i.push(o=[])),e&&(r=o,a=e,(s=t)&&(c=[],Ot.forEach((function(e){if(s[e.key]){var t=e.tag,n=e.class,i=e.style,o=e.formatter;r.push("<".concat(t).concat(n?' class="'.concat(n,'"'):"").concat(i?' style="'.concat(i,'"'):"").concat(o?o(s):"",">")),c.unshift("</".concat(t,">"))}}))),r.push(a.replace(/[\s<>]/gi,jt)),c&&c.length>0&&r.push.apply(r,c))}))}})),0===o.length&&i.pop(),e.innerHTML=i.map((function(e){var t=Vt[e.$type],i=[];return t!==n&&(n&&i.push(n.suffix),t&&i.push(t.prefix)),n=t,i.push("<".concat(t?t.tag:"p",">")),i.push(e.join("")||"<br />"),i.push("</".concat(t?t.tag:"p",">")),i.join("")})).join("")||$t}var Ht=[{key:"fo:font-weight",value:"bold",tag:"b"},{key:"fo:font-style",value:"italic",tag:"i"},{key:"fo:text-decoration",value:"underline",tag:"u"}];function Ft(e,t){var n=[];t.paragraphs instanceof Array&&t.paragraphs.forEach((function(e){n.push("<p>"),e.spans instanceof Array&&e.spans.forEach((function(e){return function(e,t){if(t.text){var n,i=t.style&&t.style.properties;i&&(n=[],Ht.forEach((function(t){if(i[t.key]===t.value){var o=t.tag,r=t.class,a=t.style;e.push("<".concat(o).concat(r?' class="'.concat(r,'"'):"").concat(a?' style="'.concat(a,'"'):"",">")),n.unshift("</".concat(o,">"))}}))),e.push(t.text.replace(/\s/gi,"&nbsp;")),n&&n.length>0&&e.push.apply(e,n)}else e.push("<br />")}(n,e)})),n.push("</p>")})),e.innerHTML=n.join("")||$t}function _t(e,t){e instanceof Node&&(t||(t={}),t.ops?Gt(e,t.ops):t.html&&t.html.content?Ft(e,t.html.content):t.plain?function(e,t){e.innerHTML=t.content?"<p>".concat(String(t.content).split("\n").map((function(e){return e.replace(/\s/gi,"&nbsp;")})).join("</p><p>"),"</p>"):$t}(e,t.plain):e.innerHTML=$t)}function Wt(e,t,n,i){var o=t||[];return e&&(e.normalize(),e.childNodes.forEach((function(t){if(t instanceof HTMLBRElement)e.childElementCount>1&&o.push(n=[]);else if(t.nodeType===Node.TEXT_NODE)n||o.push(n=[]),n.push({attr:i,text:t.textContent});else{if(t.childNodes.length<=0)return;if(t instanceof HTMLParagraphElement)o.push(n=[]),n=Wt(t,o,n,i).paragraph;else if(t instanceof HTMLLIElement)o.push(n=[]),n.$type=e instanceof HTMLUListElement?"bullet":"ordered",Wt(t,o,n,i).paragraph,n=void 0;else if(t instanceof HTMLUListElement||t instanceof HTMLOListElement)n=Wt(t,o,void 0,i).paragraph;else if(t instanceof HTMLSpanElement){var r=Object.assign({},i),a=t.style;a.color&&(r.color=a.color),n=Wt(t,o,n,r).paragraph}else if(t instanceof HTMLElement){var s=String(t.nodeName).toLowerCase();if("code"===s){var c=Object.assign({},i);c.code=!0,n=Wt(t,o,n,c).paragraph}else if("b"===s){var l=Object.assign({},i);l.bold=!0,n=Wt(t,o,n,l).paragraph}else if("i"===s){var u=Object.assign({},i);u.italic=!0,n=Wt(t,o,n,u).paragraph}else if("u"===s){var p=Object.assign({},i);p.underline=!0,n=Wt(t,o,n,p).paragraph}else n=Wt(t,o,n,Object.assign({},i)).paragraph}}}))),{paragraphSet:o,paragraph:n}}function Ut(e){var t=[];return e.forEach((function(e){var n=[];t.push({spans:n}),e instanceof Array&&e.forEach((function(e){if(e.attr){var t={},i={type:"text",properties:t};e.attr.bold&&(t["fo:font-weight"]="bold"),e.attr.italic&&(t["fo:font-style"]="italic"),e.attr.underline&&(t["fo:text-decoration"]="underline"),n.push({style:i,text:e.text})}else n.push({text:e.text})}))})),t}function Xt(e){var t,n,i,o=Wt(e).paragraphSet;return{plain:{content:e.textContent},ops:{ops:(t=o,n=[],i=[],t.forEach((function(e){e instanceof Array&&(e.forEach((function(e){e.attr?(i.length>0&&n.push({insert:i.join("")}),i=[],n.push({attributes:e.attr,insert:e.text||""})):i.push(e.text||"")})),e.$type?(i.length>0&&n.push({insert:i.join("")}),i=[],n.push({attributes:{list:e.$type},insert:"\n"})):i.push("\n"))})),i.length>0&&n.push({insert:i.join("")}),n)},html:{content:{paragraphs:Ut(o)}}}}var Yt=Symbol("season.topic.notes.normalize");var Kt={p:"p",b:"b",u:"u",i:"i",ul:"ul",ol:"ol",li:"li",br:"br",h1:"p",h2:"p",h3:"p",h4:"p",h5:"p",h6:"p",div:"p",code:"code"};function Qt(e){if(!(e instanceof Node)||e[Yt])return e;switch(e.nodeType){case Node.ELEMENT_NODE:e.normalize();var t,n=Kt[String(e.nodeName).toLocaleLowerCase()];return t="string"==typeof n?document.createElementNS(e.namespaceURI,n):"function"==typeof n?n(e):function(e){var t;if(e.getAttribute("style")){var n=e.style.color;n?(t=document.createElement("span"),n&&(t.style.color=n)):e.childElementCount&&(t=document.createElement("span"))}else e.childElementCount&&(t=document.createElement("span"));return t||document.createTextNode(e.textContent)}(e),t&&(t[Yt]=!0,t instanceof Element&&e.childNodes.forEach((function(e){(e=Qt(e))&&t.appendChild(e)}))),t.normalize(),(t.childNodes.length>0||t instanceof HTMLBRElement||t.nodeType===Node.TEXT_NODE)&&t;case Node.TEXT_NODE:var i=e.cloneNode(!0);return i[Yt]=!0,i;default:return null}}function Zt(e){try{var t=e.clipboardData||window.clipboardData;if(t){var n=t.getData("text/html");if(n){var i=(new DOMParser).parseFromString(n,"text/html");if(i&&!i.querySelector("parsererror")){var o=[];i.body.childNodes.forEach((function(e){var t=Qt(e);t instanceof Node&&o.push(t.nodeType===Node.TEXT_NODE?t.wholeText:t.outerHTML)})),document.execCommand("insertHTML",!1,o.join(""))}e.preventDefault()}}}catch(t){e.preventDefault(),console.warn("Fail in filte the paste content for the note's editor. The action is cancelled.",t)}}var Jt={rootAttrs:{"mmap-layout":"row","mmap-layout-margin":"5","mmap-layout-padding":"10","mmap-layout-background":"dialogBubble","mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"notes","mmap-bind-filter-trigger":"notes"},singletonStamp:"topic-notes-shower",onInitialize:function(e){var t=this.editorNode=this.rootNode.querySelector(".season-topic-notes-editor-box");t&&(t.addEventListener("paste",this.onPaste=Zt.bind(this)),e.topic instanceof Ce&&_t(t,e.topic.data.notes))},onAfterLayout:function(e){var t=this.rootNode.getBBox(),n=e.topic.getGraphicRect();this.rootNode.setAttribute("transform","translate(".concat(n.x+(n.width-t.width)/2,", ").concat(n.y+n.height+11,")")),Ce.showNodeInSvgView(this.rootNode,this.rootNode.ownerSVGElement)},setBold:function(e,t,n){document.execCommand("bold",!1)},setItalic:function(e,t,n){document.execCommand("italic",!1)},setUnderline:function(e,t,n){document.execCommand("underline",!1)},setUnorderList:function(e,t,n){document.execCommand("insertUnorderedList",!1)},setOrderList:function(e,t,n){document.execCommand("insertOrderedList",!1)},delete:function(e,t,n){this.editorNode&&(this.editorNode.innerHTML=$t),this.close()},onClose:function(e){if(this.editorNode){this.editorNode.removeEventListener("paste",this.onPaste);var t=Xt(this.editorNode);t&&!String(t.plain.content).trim()&&(t=void 0);var n=e.topic;if(n instanceof Ce){var i=n.data.notes;n.changeData("notes",t),(i&&!0)^(t&&!0)&&n.queueAction((function(){return n.render()}))}}}};function en(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode.ownerSVGElement,'<style>.season-topic-notes-editor-button>rect{width:20px;height:20px;x: 0px;y: 0px;rx: 5px;ry: 5px;fill:rgba(255,255,255,.1);stroke:none}.season-topic-notes-editor-button>use{fill:#000;stroke:none}.season-topic-notes-editor-button>path{fill:#000;stroke:none}.season-topic-notes-editor-button:hover>use{fill:var(--topic-ui-hover-front-color);stroke:none}.season-topic-notes-editor-button:hover>path{fill:var(--topic-ui-hover-front-color);stroke:none}.season-topic-notes-editor-button:hover>rect{fill:var(--topic-ui-hover-back-color)}.season-topic-notes-editor-delete:hover>rect{fill:var(--topic-ui-danger-color)}.season-topic-notes-editor-toolbar>g>rect{rx: 5px;ry: 5px;width:20px;height:20px;x: 0px;y: 0px;}</style><g mmap-layout="line" mmap-layout-margin="5" mmap-layout-padding="0" class="season-topic-notes-editor-toolbar"><g class="season-topic-svg-button" mmap-event-click="setBold"><rect/><use href="#season-topic-predefine-image-bold" width="20" height="20"/></g><g class="season-topic-svg-button" mmap-event-click="setItalic"><rect/><use href="#season-topic-predefine-image-italic" width="20" height="20"/></g><g class="season-topic-svg-button" mmap-event-click="setUnderline"><rect/><use href="#season-topic-predefine-image-underline" width="20" height="20"/></g><g class="season-topic-svg-button" mmap-event-click="setUnorderList"><rect/><use href="#season-topic-predefine-image-unorder-list" width="20" height="20"/></g><g class="season-topic-svg-button" mmap-event-click="setOrderList"><rect/><use href="#season-topic-predefine-image-order-list" width="20" height="20"/></g><rect width="60" height="20" fill="rgba(255,255,255,0.05)" stroke="none"/><g class="season-topic-svg-button" d-svg-button-danger="" mmap-event-click="delete"><rect/><use href="#season-topic-predefine-image-delete" width="20" height="20"/></g></g><foreignObject width="210" height="170"><style>.season-topic-notes-editor-box{overflow:scroll;border:1px solid #666;box-sizing:border-box;width:100%;height:100%;outline:0;font-size:12px;word-break:break-all}.season-topic-notes-editor-box p{margin:0}.season-topic-notes-editor-box ol,.season-topic-notes-editor-box ul{margin:0;padding-left:2em}.season-topic-notes-editor-box code{background-color:#ddd;color:#ff8c00}</style><div class="season-topic-notes-editor-box" contenteditable="true"><p><br/></p></div></foreignObject>',Object.assign({topic:t,env:t.env,singletonMutex:t.id},Jt))}var tn={rootAttrs:{"mmap-layout":"row","mmap-layout-margin":"5","mmap-layout-padding":"5","mmap-layout-background":"dialogBubble","mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"priority","mmap-bind-filter-trigger":"priority"},singletonStamp:"topic-priority-editor",onInitialize:function(e){var t=this.rootNode.querySelector('g[d-priority-value="'.concat(e.topic.data.priority,'"]'));t&&t.setAttribute("d-priority-selected","")},onAfterLayout:function(e){var t=this.rootNode.getBBox(),n=e.topic.getGraphicRect();this.rootNode.setAttribute("transform","translate(".concat(n.x+(n.width-t.width)/2,", ").concat(n.y+n.height+11,")")),Ce.showNodeInSvgView(this.rootNode,this.rootNode.ownerSVGElement)},selectPriority:function(e,t,n,i){var o=Number(t.getAttribute("d-priority-value"))||0;n.topic&&o!==n.topic.data.priority&&(n.topic.changeData("priority",o),n.topic.queueAction((function(){return n.topic.render()}))),this.close()},deletePriority:function(e,t,n,i){n.topic&&(n.topic.changeData("priority"),n.topic.queueAction((function(){return n.topic.render()}))),this.close()}};var nn={rootAttrs:{"mmap-layout":"row","mmap-layout-margin":"5","mmap-layout-padding":"5","mmap-layout-background":"dialogBubble","mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"task-marker","mmap-bind-filter-trigger":"task-marker"},singletonStamp:"topic-task-marker-editor",onInitialize:function(e){if(void 0!==e.topic.data["task-marker"]){var t=Number(e.topic.data["task-marker"]),n=this.rootNode.querySelector('g[d-task-marker-value="'.concat(t>=0&&t<=8?t:"unknown",'"]'));n&&n.setAttribute("d-task-marker-selected","")}},onAfterLayout:function(e){var t=this.rootNode.getBBox(),n=e.topic.getGraphicRect();this.rootNode.setAttribute("transform","translate(".concat(n.x+(n.width-t.width)/2,", ").concat(n.y+n.height+11,")")),Ce.showNodeInSvgView(this.rootNode,this.rootNode.ownerSVGElement)},selectTaskMarker:function(e,t,n,i){var o=Number(t.getAttribute("d-task-marker-value"));isNaN(o)&&(o="unknown"),n.topic&&o!==n.topic.data["task-marker"]&&(n.topic.changeData("task-marker",o),n.topic.queueAction((function(){return n.topic.render()}))),this.close()},deleteTaskMarker:function(e,t,n,i){n.topic&&(n.topic.changeData("task-marker"),n.topic.queueAction((function(){return n.topic.render()}))),this.close()}};var on={rootAttrs:{"mmap-bind-cancel-edit":"","mmap-bind-hide-in-render":"relayout","mmap-bind-filter-edit":"title","mmap-bind-filter-trigger":"title"},singletonStamp:"topic-title-editor",onInitialize:function(e){this.mainNode=this.rootNode.querySelector("foreignObject"),this.inputNode=this.rootNode.querySelector(".season-topic-title-editor"),this.topic=e.topic,this.onSubmit=function(){var e=this,t=String(this.inputNode.value).trim();t!==this.topic.data.title&&(this.topic.changeData("title",t),this.topic.queueAction((function(){return e.topic.render()})))}.bind(this),this.onBlur=function(){this.onSubmit(),this.close()}.bind(this),this.inputNode.addEventListener("blur",this.onBlur)},onAfterLayout:function(e){var t=this,n=this.topic.env.config,i=Number(n.secondaryPadding)||5;this.inputNode.value=String(this.topic.data.title||"").trim(),this.inputNode.style.padding=this.inputNode.style.borderRadius="".concat(i,"px");var o=this.topic.getGraphicRect(),r=this.topic.getGraphicRect(".season-topic-title"),a=this.topic.$assignedNode.querySelector(".season-topic-image")?r.y-o.y-i:1,s=o.height-a-1;this.mainNode.setAttribute("x",1),this.mainNode.setAttribute("y",a),this.mainNode.setAttribute("width",o.width-2),this.mainNode.setAttribute("height",s);var c=this.topic.$assignedNode.querySelector(":scope > [season-topic-content-group] > .season-topic-title"),l=getComputedStyle(c);l&&(this.inputNode.style.fontSize=l["font-size"],this.inputNode.style.fontWeight=l["font-weight"]),this.topic.queueAction((function(){t.inputNode.focus(),t.inputNode.select()}))},onKeydown:function(e,t,n){var i=String(e.key).toLowerCase();"enter"===i?(i=void 0,this.onSubmit(),this.close()):"tab"===i?i=void 0:"escape"===i&&(i=void 0,this.close()),i||(e.preventDefault(),e.stopPropagation())},onClose:function(){this.inputNode.removeEventListener("blur",this.onBlur)}};
/**
                           * @author season <season-studio@outlook.com>
                           * @license Apache-2.0
                           */
var rn={title:{edit:function(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode,'<foreignObject><style>.season-topic-title-editor{outline:0;border:1px solid #777;box-sizing:border-box;width:100%;height:100%;color:#000;background-color:#fff}</style><input xmlns="http://www.w3.org/1999/xhtml" class="season-topic-title-editor" tabindex="0" mmap-event-keydown="onKeydown"></foreignObject>',Object.assign({topic:t,env:t.env},on))}},image:{edit:function(e){return Rt.apply(this,arguments)},trigger:function(e){return new Promise((function(t,n){try{var i=e.eventTarget;if(i instanceof Ce){var o=i.$assignedNode.ownerSVGElement.querySelector("foreignObject[season-topic-image-trigger]");o||(o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"));var r=i.$assignedNode.ownerSVGElement.querySelector("foreignObject[season-topic-image-trigger-toolbar]");if(r||(r=document.createElementNS("http://www.w3.org/2000/svg","g")),o&&r)return function(e,t,n){var i=e.$assignedNode.querySelector(":scope > [season-topic-content-group] > .season-topic-image");if(e.data.image&&i){var o=function(){var i=e.getGraphicRect(),o=e.getGraphicRect(".season-topic-image");b=o.width,y=o.height,w=o.x-i.x-g,k=o.y-i.y-g,t.setAttribute("x",w),t.setAttribute("y",k),t.setAttribute("width",b+2*g),t.setAttribute("height",y+2*g),n.setAttribute("transform","translate(".concat(i.width-g-48,", -26)"))},r=function(){x&&(x=void 0,o())},a=function(){var t=z(O.mark((function t(n){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Dt(e),n.preventDefault(),n.stopPropagation();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),s=function(t){e.changeData("image"),e.queueAction((function(){return e.render()})),h(),t.preventDefault(),t.stopPropagation()},c=function(e){if(0!=(1&e.buttons)){if(x){var n=t.ownerSVGElement.getScreenCTM().inverse().translate(e.clientX,e.clientY),i=n.e,o=n.f;b=x.oriWidth+(i-=x.startX)*x.dx,y=x.oriHeight+(o-=x.startY)*x.dy,x.dx<0&&(w=x.oriX+i),x.dy<0&&(k=x.oriY+o),b<0&&(x.dx<0&&(w+=b),b=0),y<0&&(x.dy<0&&(k+=y),y=0),t.setAttribute("x",w),t.setAttribute("y",k),t.setAttribute("width",b+2*g),t.setAttribute("height",y+2*g)}}else r()},l=function(e){for(var n in E)if(e.target.matches(n)){var i=E[n],o=i.dx,r=i.dy,a=t.ownerSVGElement.getScreenCTM().inverse().translate(e.clientX,e.clientY);x={dx:o,dy:r,startX:a.e,startY:a.f,oriWidth:b,oriHeight:y,oriX:w,oriY:k},e.preventDefault(),e.stopPropagation();break}},u=function(t){if(0==(1&t.buttons)&&x){if(b>0&&y>0){var n=e.data.image;n&&e.changeData("image",{src:n.src,width:b,height:y}),e.queueAction((function(){return e.render().queueAction(o)}))}x=void 0,t.preventDefault(),t.stopPropagation()}},p=function(e){e.preventDefault(),e.stopPropagation()},d=function(e){"escape"===String(e.key).toLowerCase()&&r()},h=function(){e.notify("topic-event-image-trigger-clear"),t.remove(),n.remove()},f=function(e){var t=e.detail;t&&"image"!==t.triggerContentType&&h()},v=function i(){t.removeEventListener("mousedown",l),t.removeEventListener("click",p),t.removeEventListener("dblclick",a),t.ownerSVGElement.removeEventListener("mousemove",c),t.ownerSVGElement.removeEventListener("mouseup",u),t.ownerSVGElement.removeEventListener("keydown",d),e.env.removeEventListener("topic-event-cancel-edit",h),e.env.removeEventListener("topic-event-trigger",f),e.env.removeEventListener("topic-event-image-trigger-clear",i);var o=n.querySelector('[d-btn-action="browser"]');o&&o.removeEventListener("click",a),(o=n.querySelector('[d-btn-action="delete"]'))&&o.removeEventListener("click",s)},g=e.env.config.padding,m=e.env.config.secondaryPadding,b=0,y=0,w=0,k=0,x=null;t.setAttribute("style","--padding:".concat(g,"px;--secondary-padding:").concat(m,"px;")),t.setAttribute("class","season-topic-image-trigger"),t.setAttribute("season-topic-image-trigger",""),t.innerHTML="",e.$assignedNode.appendChild(t),t.insertAdjacentHTML("afterbegin",'<style>.season-topic-image-trigger{position:relative}.season-topic-image-size-box{box-sizing:border-box;position:absolute;top:var(--padding);left:var(--padding);right:var(--padding);bottom:var(--padding);border:1px dashed #666;background:0 0}.season-topic-image-size-corner{box-sizing:border-box;position:absolute;--corner-size:calc((var(--padding) + 1px) / 2);border:var(--corner-size) solid rgba(0,0,0,.3);width:calc(var(--corner-size) + var(--corner-size));height:calc(var(--corner-size) + var(--corner-size))}.season-topic-image-size-corner:hover{border-color:rgba(0,0,0,.6)}.season-topic-image-size-corner-lefttop{border-right:none;border-bottom:none;top:calc(0px - var(--corner-size));left:calc(0px - var(--corner-size));cursor:nwse-resize}.season-topic-image-size-corner-leftbottom{border-right:none;border-top:none;bottom:calc(0px - var(--corner-size));left:calc(0px - var(--corner-size));cursor:nesw-resize}.season-topic-image-size-corner-righttop{border-left:none;border-bottom:none;top:calc(0px - var(--corner-size));right:calc(0px - var(--corner-size));cursor:nesw-resize}.season-topic-image-size-corner-rightbottom{border-left:none;border-top:none;bottom:calc(0px - var(--corner-size));right:calc(0px - var(--corner-size));cursor:nwse-resize}</style><div class="season-topic-image-size-box"><div class="season-topic-image-size-corner season-topic-image-size-corner-lefttop"></div><div class="season-topic-image-size-corner season-topic-image-size-corner-leftbottom"></div><div class="season-topic-image-size-corner season-topic-image-size-corner-righttop"></div><div class="season-topic-image-size-corner season-topic-image-size-corner-rightbottom"></div></div>'),e.$assignedNode.appendChild(n),n.insertAdjacentHTML("afterbegin",'<style>.season-topic-image-trigger-toolbutton>rect{rx: 6px;ry: 6px;width:24px;height:24px}</style><g class="season-topic-svg-3d-button season-topic-image-trigger-toolbutton" d-btn-action="browser"><rect/><use x="1" width="22" height="22" href="#season-topic-predefine-image-picture"/></g><g class="season-topic-svg-3d-button season-topic-image-trigger-toolbutton" d-svg-button-danger="" d-btn-action="delete" transform="translate(26, 0)"><rect/><use x="1" width="22" height="22" href="#season-topic-predefine-image-delete"/></g>');var E={".season-topic-image-size-corner-rightbottom":{dx:1,dy:1},".season-topic-image-size-corner-righttop":{dx:1,dy:-1},".season-topic-image-size-corner-lefttop":{dx:-1,dy:-1},".season-topic-image-size-corner-leftbottom":{dx:-1,dy:1}};!function(){e.notify("topic-event-image-trigger-clear"),o(),t.addEventListener("mousedown",l),t.addEventListener("click",p),t.addEventListener("dblclick",a),t.ownerSVGElement.addEventListener("mousemove",c),t.ownerSVGElement.addEventListener("mouseup",u),t.ownerSVGElement.addEventListener("keydown",d),e.env.addEventListener("topic-event-cancel-edit",h,{once:!0}),e.env.addEventListener("topic-event-trigger",f,{once:!0}),e.env.addEventListener("topic-event-image-trigger-clear",v,{once:!0});var i=n.querySelector('[d-btn-action="browser"]');i&&i.addEventListener("click",a),(i=n.querySelector('[d-btn-action="delete"]'))&&i.addEventListener("click",s)}()}else t.remove()}(i,o,r),void t()}n(B(-1,"cannot setup the trigger"))}catch(e){n(e)}}))}},priority:{edit:function(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode.ownerSVGElement,'<style>.topic-priority-edit-item>rect{width:20px;height:20px;x: 0; y: 0;rx: 5px;ry: 5px;}.topic-priority-edit-item[d-priority-selected]>rect{fill:var(--topic-ui-focus-color);stroke:var(--topic-ui-focus-border-color);stroke-width:1px;stroke-dasharray:2}.topic-priority-placeholder{fill:none;stroke:none;width:20px;height:20px;x: 0; y: 0;rx: 5px;ry: 5px;}</style><g mmap-layout="line"><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="1"><rect/><use href="#topic-priority-1" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="2"><rect/><use href="#topic-priority-2" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="3"><rect/><use href="#topic-priority-3" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="4"><rect/><use href="#topic-priority-4" width="22" height="22"/></g></g><g mmap-layout="line"><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="5"><rect/><use href="#topic-priority-5" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="6"><rect/><use href="#topic-priority-6" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="7"><rect/><use href="#topic-priority-7" width="22" height="22"/></g><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="8"><rect/><use href="#topic-priority-8" width="22" height="22"/></g></g><g mmap-layout="line"><g class="topic-priority-edit-item season-topic-svg-button" mmap-event-click="selectPriority" d-priority-value="9"><rect/><use href="#topic-priority-9" width="22" height="22"/></g><rect class="topic-priority-placeholder"/><rect class="topic-priority-placeholder"/><g class="topic-priority-edit-item season-topic-svg-button" d-svg-button-danger="" mmap-event-click="deletePriority"><rect/><use href="#season-topic-predefine-image-delete" width="20" height="20"/></g></g>',Object.assign({topic:t,env:t.env,singletonMutex:t.id},tn))}},href:{edit:function(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode.ownerSVGElement,'<style>.topic-href-edit-button>rect{x: 0;y: 0;rx: 5px;ry: 5px;width:26px;height:26px}</style><foreignObject width="100" height="26" style="padding:0 5px 0 0"><style>.season-topic-href-editor{outline:0;border:1px solid #777;box-sizing:border-box;width:100%;height:100%;color:#000;background-color:#fff;font-size:12px}</style><input xmlns="http://www.w3.org/1999/xhtml" class="season-topic-href-editor" tabindex="0"></foreignObject><g class="season-topic-svg-button topic-href-edit-button" mmap-event-click="browser"><rect/><use href="#season-topic-predefine-image-open" width="26" height="26"/></g><g class="season-topic-svg-button topic-href-edit-button" d-svg-button-danger="" mmap-event-click="delete"><rect/><use href="#season-topic-predefine-image-delete" width="26" height="26"/></g>',Object.assign({topic:t,env:t.env,singletonMutex:t.id},Bt))},trigger:function(e){var t=e.eventTarget;t instanceof Ce&&t.env.activeLink(t.env.translateHRefToURL(t.data.href).destination)}},"task-marker":{edit:function(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode.ownerSVGElement,'<style>.topic-task-marker-item>rect{width:20px;height:20px;x: 0; y: 0;rx: 5px;ry: 5px;}.topic-task-marker-item[d-task-marker-selected]>rect{fill:var(--topic-ui-focus-color);stroke:var(--topic-ui-focus-border-color);stroke-width:1px;stroke-dasharray:2}.topic-task-marker-placeholder{fill:none;stroke:none;width:20px;height:20px;x: 0;y: 0;rx: 5px;ry: 5px;}</style><g mmap-layout="line"><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="0"><rect/><use href="#topic-task-marker-0" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="1"><rect/><use href="#topic-task-marker-1" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="2"><rect/><use href="#topic-task-marker-2" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="3"><rect/><use href="#topic-task-marker-3" width="22" height="22"/></g></g><g mmap-layout="line"><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="4"><rect/><use href="#topic-task-marker-4" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="5"><rect/><use href="#topic-task-marker-5" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="6"><rect/><use href="#topic-task-marker-6" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="7"><rect/><use href="#topic-task-marker-7" width="22" height="22"/></g></g><g mmap-layout="line"><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="8"><rect/><use href="#topic-task-marker-8" width="22" height="22"/></g><g class="topic-task-marker-item season-topic-svg-button" mmap-event-click="selectTaskMarker" d-task-marker-value="unknown"><rect/><use href="#topic-task-marker-unknown" width="22" height="22"/></g><rect class="topic-task-marker-placeholder"/><g class="topic-task-marker-item season-topic-svg-button" d-svg-button-danger="" mmap-event-click="deleteTaskMarker"><rect/><use href="#season-topic-predefine-image-delete" width="20" height="20"/></g></g>',Object.assign({topic:t,env:t.env,singletonMutex:t.id},nn))}},labels:{edit:function(e){var t=e.eventTarget;t instanceof Ce&&Nt(t.$assignedNode.ownerSVGElement,'<style>.season-topic-label-edit-item{font-size:12px}.season-topic-label-edit-item>text{alignment-baseline:before-edge;dominant-baseline:text-before-edge;fill:#666}.season-topic-label-edit-item>rect{fill:none;stroke-width:.5px;stroke:#666;stroke-dasharray:2}.season-topic-label-edit-delete>rect{fill:#ddd;stroke:none}.season-topic-label-edit-delete>use{fill:#fff;stroke:none}.season-topic-label-edit-delete:hover>rect{fill:var(--topic-ui-danger-color);stroke:none}</style><g mmap-layout="line" mmap-layout-max-width="120" mmap-layout-margin="5" mmap-layout-padding="0" class="season-topic-labels-edit-list"></g><foreignObject width="120" height="26"><style>.season-topic-label-edit-input{width:100%;height:100%;outline:0;border:1px solid #ccc;box-sizing:border-box;font-size:12px}</style><input class="season-topic-label-edit-input" placeholder="new label..." mmap-event-keydown="onInputKeydown"/></foreignObject>',Object.assign({topic:t,env:t.env,singletonMutex:t.id},qt))}},notes:{edit:en,trigger:en}};e.CreateTopicExtensionFactor=wt,e.DefaultTopicEventActions=rn,e.DefaultTopicExtensions=kt,e.EBlockFactor=l,e.MindmapAddinPanel=Nt,e.MindmapContainer=ne,e.MindmapDocument=pt,e.MindmapEnvironment=K,e.MindmapViewer=yt,e.Topic=Ce,e.TopicExtension=H,e.TopicExtensionFactor=F,e.TopicFactor=it,e.generateID=o,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
